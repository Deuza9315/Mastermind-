<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Mastermind - Ultimate Edition</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --secondary: #ec4899;
            --bg-color: #0f172a;
            --glass-bg: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME CASINO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-casino {
            --primary: #f59e0b;
            --secondary: #ef4444;
            --bg-color: #080500;
            --glass-bg: rgba(15, 8, 0, 0.9);
            --glass-border: rgba(245, 158, 11, 0.35);
        }

        body.theme-casino::before {
            background: rgba(180, 120, 0, 0.18) !important;
        }

        body.theme-casino::after {
            background: rgba(200, 20, 20, 0.14) !important;
        }

        body.theme-casino .ligne {
            border-color: rgba(245, 158, 11, 0.18) !important;
            background: rgba(25, 12, 0, 0.5) !important;
        }

        body.theme-casino .board-section,
        body.theme-casino .rules-section,
        body.theme-casino .card {
            border-color: rgba(245, 158, 11, 0.35) !important;
            background: rgba(12, 6, 0, 0.92) !important;
            box-shadow: 0 4px 30px rgba(245, 158, 11, 0.2), inset 0 0 60px rgba(180, 100, 0, 0.05) !important;
        }

        body.theme-casino .palette {
            border-color: rgba(245, 158, 11, 0.35) !important;
            background: rgba(18, 9, 0, 0.6) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME NOÃ‹L â€” neige qui tombe
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-noel {
            --primary: #22c55e;
            --secondary: #ef4444;
            --bg-color: #04100a;
            --glass-bg: rgba(5, 18, 8, 0.88);
            --glass-border: rgba(34, 197, 94, 0.22);
        }

        body.theme-noel::before {
            background: rgba(20, 120, 40, 0.15) !important;
        }

        body.theme-noel::after {
            background: rgba(180, 20, 20, 0.12) !important;
        }

        body.theme-noel .ligne {
            border-color: rgba(34, 197, 94, 0.12) !important;
            background: rgba(3, 14, 5, 0.55) !important;
        }

        body.theme-noel .board-section,
        body.theme-noel .rules-section,
        body.theme-noel .card {
            border-color: rgba(34, 197, 94, 0.28) !important;
            background: rgba(3, 12, 5, 0.92) !important;
            box-shadow: 0 4px 30px rgba(34, 197, 94, 0.12) !important;
        }

        body.theme-noel .palette {
            border-color: rgba(220, 40, 40, 0.35) !important;
            background: rgba(3, 14, 5, 0.6) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME GALAXY â€” Ã©toiles filantes
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-galaxy {
            --primary: #a78bfa;
            --secondary: #38bdf8;
            --bg-color: #00000a;
            --glass-bg: rgba(5, 2, 20, 0.88);
            --glass-border: rgba(167, 139, 250, 0.2);
        }

        body.theme-galaxy::before {
            background: rgba(80, 0, 200, 0.12) !important;
        }

        body.theme-galaxy::after {
            background: rgba(0, 180, 255, 0.08) !important;
        }

        body.theme-galaxy .ligne {
            border-color: rgba(167, 139, 250, 0.1) !important;
            background: rgba(2, 0, 12, 0.55) !important;
        }

        body.theme-galaxy .board-section,
        body.theme-galaxy .rules-section,
        body.theme-galaxy .card {
            border-color: rgba(167, 139, 250, 0.2) !important;
            background: rgba(2, 0, 12, 0.92) !important;
            box-shadow: 0 0 30px rgba(80, 0, 200, 0.15) !important;
        }

        body.theme-galaxy .palette {
            border-color: rgba(56, 189, 248, 0.2) !important;
            background: rgba(2, 0, 12, 0.65) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME FORÃŠT ENCHANTÃ‰E ğŸŒ¿
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-foret {
            --primary: #4ade80;
            --secondary: #a3e635;
            --bg-color: #020d04;
            --glass-bg: rgba(2, 14, 5, 0.9);
            --glass-border: rgba(74, 222, 128, 0.18);
        }

        body.theme-foret::before {
            background: rgba(20, 100, 30, 0.18) !important;
        }

        body.theme-foret::after {
            background: rgba(100, 180, 20, 0.1) !important;
        }

        body.theme-foret .ligne {
            border-color: rgba(74, 222, 128, 0.1) !important;
            background: rgba(1, 8, 2, 0.55) !important;
        }

        body.theme-foret .board-section,
        body.theme-foret .rules-section,
        body.theme-foret .card {
            border-color: rgba(74, 222, 128, 0.2) !important;
            background: rgba(1, 8, 2, 0.92) !important;
            box-shadow: 0 0 30px rgba(20, 100, 30, 0.18) !important;
        }

        body.theme-foret .palette {
            border-color: rgba(74, 222, 128, 0.2) !important;
            background: rgba(1, 10, 3, 0.65) !important;
        }

        body.theme-foret #snow-canvas {
            visibility: visible;
        }

        body.theme-foret .page {
            z-index: 1;
            position: relative;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME DÃ‰SERT & SABLE ğŸœï¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-desert {
            --primary: #f59e0b;
            --secondary: #fb923c;
            --bg-color: #0d0800;
            --glass-bg: rgba(20, 12, 2, 0.9);
            --glass-border: rgba(245, 158, 11, 0.2);
        }

        body.theme-desert::before {
            background: rgba(200, 120, 0, 0.14) !important;
        }

        body.theme-desert::after {
            background: rgba(180, 80, 0, 0.1) !important;
        }

        body.theme-desert .ligne {
            border-color: rgba(245, 158, 11, 0.1) !important;
            background: rgba(15, 8, 0, 0.55) !important;
        }

        body.theme-desert .board-section,
        body.theme-desert .rules-section,
        body.theme-desert .card {
            border-color: rgba(245, 158, 11, 0.2) !important;
            background: rgba(12, 6, 0, 0.92) !important;
            box-shadow: 0 0 30px rgba(200, 120, 0, 0.15) !important;
        }

        body.theme-desert .palette {
            border-color: rgba(245, 158, 11, 0.2) !important;
            background: rgba(15, 8, 0, 0.65) !important;
        }

        body.theme-desert #snow-canvas {
            visibility: visible;
        }

        body.theme-desert .page {
            z-index: 1;
            position: relative;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME OCÃ‰AN ğŸŒŠ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-ocean {
            --primary: #38bdf8;
            --secondary: #818cf8;
            --bg-color: #00050f;
            --glass-bg: rgba(0, 8, 22, 0.9);
            --glass-border: rgba(56, 189, 248, 0.18);
        }

        body.theme-ocean::before {
            background: rgba(0, 80, 160, 0.18) !important;
        }

        body.theme-ocean::after {
            background: rgba(0, 40, 120, 0.12) !important;
        }

        body.theme-ocean .ligne {
            border-color: rgba(56, 189, 248, 0.1) !important;
            background: rgba(0, 5, 15, 0.55) !important;
        }

        body.theme-ocean .board-section,
        body.theme-ocean .rules-section,
        body.theme-ocean .card {
            border-color: rgba(56, 189, 248, 0.2) !important;
            background: rgba(0, 5, 15, 0.92) !important;
            box-shadow: 0 0 30px rgba(0, 80, 160, 0.18) !important;
        }

        body.theme-ocean .palette {
            border-color: rgba(56, 189, 248, 0.2) !important;
            background: rgba(0, 5, 15, 0.65) !important;
        }

        body.theme-ocean #snow-canvas {
            visibility: visible;
        }

        body.theme-ocean .page {
            z-index: 1;
            position: relative;
        }

        body.theme-galaxy #snow-canvas {
            display: block;
        }

        body.theme-galaxy .page {
            z-index: 1;
            position: relative;
        }

        #snow-canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 0;
            visibility: hidden;
        }

        body.theme-noel #snow-canvas,
        body.theme-galaxy #snow-canvas {
            visibility: visible;
        }

        html {
            overflow-x: hidden !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THÃˆME ARCADE RÃ‰TRO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.theme-arcade {
            --primary: #00ffcc;
            --secondary: #ff00ff;
            --bg-color: #060010;
            --glass-bg: rgba(0, 0, 18, 0.9);
            --glass-border: rgba(0, 255, 204, 0.2);
        }

        body.theme-arcade::before {
            background: rgba(0, 255, 204, 0.1) !important;
        }

        body.theme-arcade::after {
            background: rgba(255, 0, 255, 0.1) !important;
        }

        body.theme-arcade .ligne {
            border-color: rgba(0, 255, 204, 0.1) !important;
            background: rgba(0, 0, 14, 0.55) !important;
        }

        body.theme-arcade .board-section,
        body.theme-arcade .rules-section,
        body.theme-arcade .card {
            border-color: rgba(0, 255, 204, 0.22) !important;
            background: rgba(0, 0, 12, 0.92) !important;
            box-shadow: 0 0 28px rgba(0, 255, 204, 0.12) !important;
        }

        body.theme-arcade .palette {
            border-color: rgba(255, 0, 255, 0.3) !important;
            background: rgba(0, 0, 14, 0.65) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -1;
        }

        body::before {
            top: -10%;
            left: -10%;
            width: 50vw;
            height: 50vw;
            background: rgba(139, 92, 246, 0.2);
        }

        body::after {
            bottom: -10%;
            right: -10%;
            width: 50vw;
            height: 50vw;
            background: rgba(236, 72, 153, 0.15);
        }

        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }

        .active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .card,
        .board-section,
        .rules-section {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            box-sizing: border-box;
        }

        .card {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        h1 {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 20px;
            font-weight: 900;
        }

        input {
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            width: 85%;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            box-sizing: border-box;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        button {
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 99px;
            border: none;
            font-weight: bold;
            margin: 8px;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-p {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
        }

        .btn-p:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6);
            transform: translateY(-2px);
        }

        .btn-s {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
        }

        .btn-s:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .coin-banner {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 99px;
            color: #fbbf24;
            font-weight: bold;
            border: 1px solid #fbbf24;
            margin-bottom: 15px;
            display: inline-block;
        }

        #admin-badge {
            background: #ef4444;
            color: white;
            padding: 5px 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: none;
        }

        .shop-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            width: 100%;
        }

        .shop-tab {
            flex: 1;
            padding: 9px;
            border-radius: 12px;
            font-size: 0.82rem;
            cursor: pointer;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-muted);
            transition: 0.2s;
            font-weight: bold;
            text-transform: uppercase;
        }

        .shop-tab.active-tab {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
        }

        .shop-section {
            display: none;
        }

        .shop-section.active-section {
            display: block;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            width: 100%;
            max-height: 370px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
        }

        .shop-item h4,
        .shop-item p {
            margin: 0;
        }

        .shop-item p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .shop-item button {
            padding: 8px 16px;
            margin: 0;
            font-size: 0.8rem;
        }

        .game-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .board-section {
            padding: 20px;
            flex-grow: 1;
            max-width: 450px;
        }

        .rules-section {
            max-width: 280px;
            text-align: left;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .rules-section h3 {
            color: white;
            margin-top: 0;
            font-weight: 600;
        }

        .ligne {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 99px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: 0.3s;
        }

        .pions-container {
            display: flex;
            gap: 8px;
        }

        .emp {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: 0.3s ease;
        }

        .bloc-ind {
            display: grid;
            gap: 4px;
            padding: 4px;
            border-radius: 8px;
        }

        .pt {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 99px;
            border: 1px solid var(--glass-border);
        }

        .choix {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .choix:hover {
            transform: scale(1.2);
        }

        /* COULEURS BASE */
        .rouge {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
        }

        .bleu {
            background: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
        }

        .vert {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
        }

        .jaune {
            background: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.6);
        }

        .orange {
            background: #f97316;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.6);
        }

        .violet {
            background: #8b5cf6;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.6);
        }

        .noir {
            background: #000;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.8), inset 0 0 2px rgba(255, 255, 255, 0.3) !important;
            border: 1px solid #333;
        }

        .blanc {
            background: #fff;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8) !important;
            border: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN ZÃˆBRE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.skin-zebre .emp,
        body.skin-zebre .choix {
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.25) !important;
        }

        body.skin-zebre .emp::before,
        body.skin-zebre .choix::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            background-image: repeating-linear-gradient(-40deg, transparent 0px, transparent 5px, rgba(0, 0, 0, 0.75) 5px, rgba(0, 0, 0, 0.75) 10px, transparent 10px, transparent 16px, rgba(0, 0, 0, 0.55) 16px, rgba(0, 0, 0, 0.55) 20px);
        }

        body.skin-zebre .emp::after,
        body.skin-zebre .choix::after {
            content: '';
            position: absolute;
            top: 8%;
            left: 12%;
            width: 42%;
            height: 32%;
            background: radial-gradient(ellipse, rgba(255, 255, 255, 0.45) 0%, transparent 75%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN FRUITS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.skin-fruits .emp,
        body.skin-fruits .choix {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2) !important;
            box-shadow: none !important;
            font-size: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        body.skin-fruits .rouge::after {
            content: 'ğŸ';
        }

        body.skin-fruits .bleu::after {
            content: 'ğŸ«';
        }

        body.skin-fruits .vert::after {
            content: 'ğŸ';
        }

        body.skin-fruits .jaune::after {
            content: 'ğŸ‹';
        }

        body.skin-fruits .orange::after {
            content: 'ğŸŠ';
        }

        body.skin-fruits .violet::after {
            content: 'ğŸ‡';
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN PLANÃˆTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.skin-planetes .emp,
        body.skin-planetes .choix {
            background-size: cover !important;
            background-position: center !important;
            box-shadow: inset -4px -4px 8px rgba(0, 0, 0, 0.7) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        body.skin-planetes .rouge {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/120px-OSIRIS_Mars_true_color.jpg') !important;
        }

        body.skin-planetes .bleu {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/120px-The_Earth_seen_from_Apollo_17.jpg') !important;
        }

        body.skin-planetes .vert {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/120px-Uranus2.jpg') !important;
        }

        body.skin-planetes .jaune {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Venus-real_color.jpg/120px-Venus-real_color.jpg') !important;
        }

        body.skin-planetes .orange {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Jupiter.jpg/120px-Jupiter.jpg') !important;
        }

        body.skin-planetes .violet {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Neptune_Full.jpg/120px-Neptune_Full.jpg') !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN GALAXIE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @keyframes rotateGal {
            100% {
                transform: rotate(360deg);
            }
        }

        body.skin-galaxie .rouge {
            background: radial-gradient(circle at 35% 35%, #ff2200 0%, #6b0000 50%, #0a0000 100%) !important;
        }

        body.skin-galaxie .bleu {
            background: radial-gradient(circle at 35% 35%, #0066ff 0%, #000d4d 50%, #00000a 100%) !important;
        }

        body.skin-galaxie .vert {
            background: radial-gradient(circle at 35% 35%, #00ff88 0%, #004d22 50%, #000a04 100%) !important;
        }

        body.skin-galaxie .jaune {
            background: radial-gradient(circle at 35% 35%, #ffcc00 0%, #664d00 50%, #0a0800 100%) !important;
        }

        body.skin-galaxie .orange {
            background: radial-gradient(circle at 35% 35%, #ff6600 0%, #662200 50%, #0a0300 100%) !important;
        }

        body.skin-galaxie .violet {
            background: radial-gradient(circle at 35% 35%, #aa00ff 0%, #3d0066 50%, #07000a 100%) !important;
        }

        body.skin-galaxie .emp,
        body.skin-galaxie .choix {
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.12), inset 0 0 8px rgba(0, 0, 0, 0.6) !important;
        }

        body.skin-galaxie .emp::before,
        body.skin-galaxie .choix::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.95) 1px, transparent 1px) 0 0/10px 10px,
                radial-gradient(circle, rgba(255, 255, 255, 0.55) 1.5px, transparent 1.5px) 5px 5px/16px 16px,
                radial-gradient(circle, rgba(255, 255, 255, 0.35) 1px, transparent 1px) 3px 7px/13px 13px;
            animation: rotateGal 10s linear infinite;
            opacity: 0.9;
            pointer-events: none;
        }

        body.skin-galaxie .emp::after,
        body.skin-galaxie .choix::after {
            content: '';
            position: absolute;
            top: 8%;
            left: 12%;
            width: 40%;
            height: 30%;
            background: radial-gradient(ellipse, rgba(255, 255, 255, 0.35) 0%, transparent 75%);
            border-radius: 50%;
            pointer-events: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN JETONS CASINO â€” valeurs gravÃ©es
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* Les valeurs sont injectÃ©es via JS dans data-val, affichÃ©es via ::after */
        body.skin-casino .emp,
        body.skin-casino .choix {
            position: relative;
            overflow: hidden;
            border-radius: 50%;
        }

        body.skin-casino .rouge {
            background: conic-gradient(#cc0000 0deg, #ff4444 30deg, #cc0000 60deg, #ff4444 90deg, #cc0000 120deg, #ff4444 150deg, #cc0000 180deg, #ff4444 210deg, #cc0000 240deg, #ff4444 270deg, #cc0000 300deg, #ff4444 330deg, #cc0000 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #cc0000, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        body.skin-casino .bleu {
            background: conic-gradient(#1d4ed8 0deg, #60a5fa 30deg, #1d4ed8 60deg, #60a5fa 90deg, #1d4ed8 120deg, #60a5fa 150deg, #1d4ed8 180deg, #60a5fa 210deg, #1d4ed8 240deg, #60a5fa 270deg, #1d4ed8 300deg, #60a5fa 330deg, #1d4ed8 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #1d4ed8, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        body.skin-casino .vert {
            background: conic-gradient(#15803d 0deg, #4ade80 30deg, #15803d 60deg, #4ade80 90deg, #15803d 120deg, #4ade80 150deg, #15803d 180deg, #4ade80 210deg, #15803d 240deg, #4ade80 270deg, #15803d 300deg, #4ade80 330deg, #15803d 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #15803d, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        body.skin-casino .jaune {
            background: conic-gradient(#b45309 0deg, #fde68a 30deg, #b45309 60deg, #fde68a 90deg, #b45309 120deg, #fde68a 150deg, #b45309 180deg, #fde68a 210deg, #b45309 240deg, #fde68a 270deg, #b45309 300deg, #fde68a 330deg, #b45309 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #b45309, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        body.skin-casino .orange {
            background: conic-gradient(#c2410c 0deg, #fdba74 30deg, #c2410c 60deg, #fdba74 90deg, #c2410c 120deg, #fdba74 150deg, #c2410c 180deg, #fdba74 210deg, #c2410c 240deg, #fdba74 270deg, #c2410c 300deg, #fdba74 330deg, #c2410c 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #c2410c, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        body.skin-casino .violet {
            background: conic-gradient(#6d28d9 0deg, #c4b5fd 30deg, #6d28d9 60deg, #c4b5fd 90deg, #6d28d9 120deg, #c4b5fd 150deg, #6d28d9 180deg, #c4b5fd 210deg, #6d28d9 240deg, #c4b5fd 270deg, #6d28d9 300deg, #c4b5fd 330deg, #6d28d9 360deg) !important;
            box-shadow: 0 0 0 3px #fff, 0 0 0 5px #6d28d9, 0 4px 14px rgba(0, 0, 0, 0.7) !important;
        }

        /* Centre du jeton avec valeur */
        body.skin-casino .emp::before,
        body.skin-casino .choix::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 55%;
            height: 55%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.92);
            pointer-events: none;
            z-index: 1;
        }

        /* Valeur affichÃ©e */
        body.skin-casino .emp::after,
        body.skin-casino .choix::after {
            content: attr(data-val);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 7px;
            font-weight: 900;
            color: #111;
            font-family: Arial, sans-serif;
            letter-spacing: -0.5px;
            pointer-events: none;
            z-index: 2;
            text-shadow: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN BONBONS â€” SVG rÃ©alistes
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.skin-bonbons .emp,
        body.skin-bonbons .choix {
            display: flex;
            justify-content: center;
            align-items: center;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            overflow: hidden;
        }

        body.skin-bonbons .emp svg,
        body.skin-bonbons .choix svg {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIN MARIO BROS â€” tÃªtes SVG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        body.skin-mario .emp,
        body.skin-mario .choix {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.1) !important;
            box-shadow: none !important;
            border: 2px solid rgba(255, 255, 255, 0.12) !important;
            overflow: hidden;
            padding: 0;
        }

        body.skin-mario .emp svg,
        body.skin-mario .choix svg {
            width: 26px;
            height: 26px;
        }

        /* On affiche les SVG via ::after avec background-image â€” mais SVG inline est mieux, donc on les injecte via JS */

        #barre-commentaires {
            margin-top: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            font-style: italic;
            text-align: center;
            color: var(--text-main);
            font-size: 0.9rem;
        }

        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .toggle-row:last-child {
            border-bottom: none;
        }

        .toggle-row label {
            font-size: 0.95rem;
            color: var(--text-main);
        }

        .toggle-row span {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: block;
            margin-top: 2px;
        }

        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle input:checked+.toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .toggle input:checked+.toggle-slider::before {
            transform: translateX(20px);
        }

        #vol-slider {
            width: 100%;
            margin-top: 8px;
            accent-color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        th {
            color: white;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--glass-border);
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        td {
            padding: 12px 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            color: var(--text-muted);
        }

        #modal-fin {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }
    </style>
</head>

<body>
    <canvas id="snow-canvas"></canvas>

    <!-- LOGIN -->
    <div id="p-login" class="page active">
        <h1>MASTERMIND</h1>
        <div class="card">
            <h3 style="margin-top:0;">Connexion</h3>
            <input type="text" id="pseudo" placeholder="Votre Pseudo">
            <input type="password" id="mdp" placeholder="Votre Mot de passe">
            <br><br>
            <button class="btn-p" onclick="connexion()" style="width:100%;">Jouer</button>
            <hr style="border-color:var(--glass-border);margin:20px 0;">
            <button class="btn-s" onclick="jouerInvite()" style="width:100%;">Mode InvitÃ©</button>
        </div>
    </div>

    <!-- MENU -->
    <div id="p-menu" class="page">
        <h1 id="txt-bienvenue">Salut !</h1>
        <div id="admin-badge">âš¡ MODE ADMIN ACTIF</div>
        <div class="coin-banner">ğŸ’° <span id="menu-coins">0</span> piÃ¨ces</div>
        <div class="card">
            <button class="btn-p" onclick="nav('p-mode')" style="width:100%;margin-bottom:10px;">Lancer une
                partie</button>
            <button class="btn-s" onclick="nav('p-boutique')" style="width:100%;margin-bottom:10px;">ğŸ›’
                Boutique</button>
            <button class="btn-s" onclick="voirScores()" style="width:100%;margin-bottom:10px;">Scores</button>
            <button class="btn-s" onclick="nav('p-params')" style="width:100%;">âš™ï¸ ParamÃ¨tres</button>
            <button onclick="location.reload()" class="btn-s"
                style="width:100%;margin-top:25px;border:none;color:#ef4444;">DÃ©connexion</button>
        </div>
    </div>

    <!-- PARAMÃˆTRES -->
    <div id="p-params" class="page">
        <h1>ParamÃ¨tres</h1>
        <div class="card" style="max-width:480px;text-align:left;">
            <h3 style="margin-top:0;color:white;">ğŸ”Š Audio</h3>
            <div class="toggle-row">
                <div><label>Musique du menu</label><span>Chiptune 8-bit rÃ©tro</span></div>
                <label class="toggle"><input type="checkbox" id="tog-musique" checked
                        onchange="toggleMusique(this.checked)"><span class="toggle-slider"></span></label>
            </div>
            <div class="toggle-row">
                <div><label>Sons des pions</label><span>Clic bois satisfaisant</span></div>
                <label class="toggle"><input type="checkbox" id="tog-sfx" checked
                        onchange="toggleSfx(this.checked)"><span class="toggle-slider"></span></label>
            </div>
            <div class="toggle-row">
                <div><label>Sons de victoire / dÃ©faite</label><span>Fanfare ou buzzer</span></div>
                <label class="toggle"><input type="checkbox" id="tog-win" checked
                        onchange="toggleWin(this.checked)"><span class="toggle-slider"></span></label>
            </div>
            <div style="margin-top:12px;">
                <label style="font-size:0.9rem;color:var(--text-muted);">Volume gÃ©nÃ©ral</label>
                <input type="range" id="vol-slider" min="0" max="100" value="60" oninput="setVolume(this.value)">
            </div>
            <button class="btn-s" onclick="nav('p-menu')" style="width:100%;margin-top:24px;">Retour Menu</button>
        </div>
    </div>

    <!-- BOUTIQUE -->
    <div id="p-boutique" class="page">
        <h1>BOUTIQUE</h1>
        <div class="coin-banner">Solde : <span id="shop-coins">0</span> ğŸ’°</div>
        <div class="card" style="max-width:540px;">
            <div class="shop-tabs">
                <button class="shop-tab active-tab" onclick="switchTab('skins')">ğŸ¨ Skins Pions</button>
                <button class="shop-tab" onclick="switchTab('themes')">ğŸ–¼ ThÃ¨mes Plateau</button>
            </div>
            <div id="tab-skins" class="shop-section active-section">
                <div class="shop-grid" id="shop-skins"></div>
            </div>
            <div id="tab-themes" class="shop-section">
                <div class="shop-grid" id="shop-themes"></div>
            </div>
            <button class="btn-s" onclick="nav('p-menu')" style="width:100%;margin-top:20px;">Retour Menu</button>
        </div>
    </div>

    <!-- MODE -->
    <div id="p-mode" class="page">
        <h1>DifficultÃ©</h1>
        <div class="card">
            <button class="btn-s" onclick="lancer(4)" style="width:100%;margin-bottom:15px;">Normal (4 Pions)</button>
            <button class="btn-p" style="background:linear-gradient(135deg,#ef4444,#f97316);width:100%;"
                onclick="lancer(6)">HARDCORE (6 Pions)</button>
            <button onclick="nav('p-menu')" class="btn-s" style="border:none;margin-top:20px;">Retour</button>
        </div>
    </div>

    <!-- JEU -->
    <div id="p-jeu" class="page" style="max-width:950px;">
        <div style="display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:20px;">
            <span id="txt-mode" style="font-weight:bold;color:var(--text-muted);">Mode: 4</span>
            <span id="chrono" style="color:white;font-weight:bold;font-size:1.5rem;">00:00</span>
            <button onclick="nav('p-menu')" class="btn-s" style="padding:6px 12px;">Quitter</button>
        </div>
        <div class="game-layout">
            <div class="board-section">
                <div id="lignes-c"></div>
                <div class="palette" id="pal"></div>
                <div style="text-align:center;margin-top:20px;">
                    <button id="btn-v" class="btn-p" onclick="valider()" disabled style="width:80%;">Valider</button>
                </div>
                <div id="barre-commentaires">PrÃªt Ã  jouer ? âš¡</div>
            </div>
            <div class="rules-section">
                <h3>Objectif</h3>
                <p>Trouver le code couleur en 10 essais. (+10 ğŸ’° / victoire)</p>
                <h3 style="margin-top:25px;">Indices</h3>
                <ul style="list-style:none;padding:0;">
                    <li
                        style="margin-bottom:12px;display:flex;align-items:center;gap:12px;background:rgba(0,0,0,0.2);padding:10px;border-radius:12px;">
                        <span class="pt noir"></span><span style="font-size:0.85rem;"><b>Noir</b> = Bonne place</span>
                    </li>
                    <li
                        style="display:flex;align-items:center;gap:12px;background:rgba(0,0,0,0.2);padding:10px;border-radius:12px;">
                        <span class="pt blanc"></span><span style="font-size:0.85rem;"><b>Blanc</b> = Mauvaise
                            place</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- SCORES -->
    <div id="p-score" class="page">
        <h1>Leaderboard</h1>
        <div class="card" style="max-width:600px;">
            <table>
                <thead>
                    <tr>
                        <th>Joueur</th>
                        <th>Mode</th>
                        <th>Essais</th>
                        <th>Temps</th>
                    </tr>
                </thead>
                <tbody id="corps-scores"></tbody>
            </table>
            <button class="btn-s" onclick="nav('p-menu')" style="margin-top:20px;width:100%;">Retour Menu</button>
        </div>
    </div>

    <!-- MODAL FIN -->
    <div id="modal-fin">
        <div class="card">
            <h1 id="fin-titre" style="color:white;">FIN</h1>
            <p id="fin-desc" style="color:var(--text-muted);line-height:1.5;"></p>
            <div id="fin-secret"
                style="display:none;margin:20px 0;padding:15px;background:rgba(239,68,68,0.1);border-radius:12px;border:1px solid rgba(239,68,68,0.3);">
                <p style="color:#ef4444;font-weight:bold;margin:0 0 10px 0;">Le code secret :</p>
                <span id="secret-texte" style="color:white;font-size:1.1rem;letter-spacing:1px;"></span>
            </div>
            <button class="btn-s" onclick="nav('p-menu');document.getElementById('modal-fin').style.display='none';"
                style="width:100%;">Continuer</button>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);

        /* â”€â”€ CANVAS (neige + galaxie) â”€â”€ */
        const snowCanvas = $('snow-canvas');
        const snowCtx = snowCanvas.getContext('2d');
        let snowFlakes = [], shootingStars = [], bgStars = [];
        let snowActive = false, galaxyActive = false, snowRAF = null;

        function initSnow() {
            snowCanvas.width = window.innerWidth;
            snowCanvas.height = window.innerHeight;
            snowFlakes = [];
            for (let i = 0; i < 120; i++) {
                snowFlakes.push({
                    x: Math.random() * snowCanvas.width, y: Math.random() * snowCanvas.height,
                    r: Math.random() * 4 + 1, speed: Math.random() * 1.2 + 0.4,
                    drift: (Math.random() - 0.5) * 0.5, opacity: Math.random() * 0.6 + 0.4,
                    wobble: Math.random() * Math.PI * 2, wobbleSpeed: Math.random() * 0.03 + 0.01
                });
            }
        }
        function animateSnow() {
            if (!snowActive) return;
            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            snowFlakes.forEach(f => {
                f.wobble += f.wobbleSpeed; f.y += f.speed; f.x += f.drift + Math.sin(f.wobble) * 0.3;
                if (f.y > snowCanvas.height) { f.y = -5; f.x = Math.random() * snowCanvas.width; }
                if (f.x > snowCanvas.width) f.x = 0;
                if (f.x < 0) f.x = snowCanvas.width;
                snowCtx.beginPath(); snowCtx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                snowCtx.fillStyle = `rgba(255,255,255,${f.opacity})`; snowCtx.fill();
                snowCtx.beginPath(); snowCtx.arc(f.x - f.r * 0.3, f.y - f.r * 0.3, f.r * 0.4, 0, Math.PI * 2);
                snowCtx.fillStyle = 'rgba(255,255,255,0.9)'; snowCtx.fill();
            });
            snowRAF = requestAnimationFrame(animateSnow);
        }

        function initGalaxy() {
            snowCanvas.width = window.innerWidth;
            snowCanvas.height = window.innerHeight;
            bgStars = [];
            for (let i = 0; i < 220; i++) {
                bgStars.push({
                    x: Math.random() * snowCanvas.width, y: Math.random() * snowCanvas.height,
                    r: Math.random() * 1.5 + 0.3, opacity: Math.random() * 0.7 + 0.3,
                    twinkleSpeed: Math.random() * 0.02 + 0.005, twinklePhase: Math.random() * Math.PI * 2
                });
            }
            shootingStars = [];
            for (let i = 0; i < 6; i++) spawnStar();
        }
        function spawnStar() {
            shootingStars.push({
                x: Math.random() * snowCanvas.width * 1.3,
                y: Math.random() * snowCanvas.height * 0.5,
                len: Math.random() * 120 + 60,
                speed: Math.random() * 8 + 6,
                angle: Math.PI / 5 + (Math.random() - 0.5) * 0.3,
                opacity: 0, fadeIn: true,
                delay: Math.random() * 200
            });
        }
        function animateGalaxy() {
            if (!galaxyActive) return;
            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            // Fond Ã©toilÃ© fixe
            bgStars.forEach(s => {
                s.twinklePhase += s.twinkleSpeed;
                let op = s.opacity * (0.6 + 0.4 * Math.sin(s.twinklePhase));
                snowCtx.beginPath(); snowCtx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                snowCtx.fillStyle = `rgba(255,255,255,${op})`; snowCtx.fill();
            });
            // NÃ©buleuse subtile
            let nb = snowCtx.createRadialGradient(snowCanvas.width * 0.3, snowCanvas.height * 0.4, 10, snowCanvas.width * 0.3, snowCanvas.height * 0.4, 300);
            nb.addColorStop(0, 'rgba(80,0,200,0.04)'); nb.addColorStop(1, 'transparent');
            snowCtx.fillStyle = nb; snowCtx.fillRect(0, 0, snowCanvas.width, snowCanvas.height);
            let nb2 = snowCtx.createRadialGradient(snowCanvas.width * 0.7, snowCanvas.height * 0.6, 10, snowCanvas.width * 0.7, snowCanvas.height * 0.6, 250);
            nb2.addColorStop(0, 'rgba(0,100,200,0.04)'); nb2.addColorStop(1, 'transparent');
            snowCtx.fillStyle = nb2; snowCtx.fillRect(0, 0, snowCanvas.width, snowCanvas.height);
            // Ã‰toiles filantes
            shootingStars.forEach((s, i) => {
                if (s.delay > 0) { s.delay--; return; }
                let dx = Math.cos(s.angle) * s.speed, dy = Math.sin(s.angle) * s.speed;
                if (s.fadeIn) { s.opacity += 0.06; if (s.opacity >= 1) s.fadeIn = false; }
                else { s.opacity -= 0.025; }
                if (s.opacity <= 0) { shootingStars[i] = null; return; }
                let tail = snowCtx.createLinearGradient(s.x, s.y, s.x - Math.cos(s.angle) * s.len, s.y - Math.sin(s.angle) * s.len);
                tail.addColorStop(0, `rgba(255,255,255,${s.opacity})`);
                tail.addColorStop(0.3, `rgba(180,160,255,${s.opacity * 0.6})`);
                tail.addColorStop(1, 'rgba(100,80,255,0)');
                snowCtx.beginPath();
                snowCtx.moveTo(s.x, s.y);
                snowCtx.lineTo(s.x - Math.cos(s.angle) * s.len, s.y - Math.sin(s.angle) * s.len);
                snowCtx.strokeStyle = tail; snowCtx.lineWidth = 2; snowCtx.stroke();
                // TÃªte lumineuse
                snowCtx.beginPath(); snowCtx.arc(s.x, s.y, 2, 0, Math.PI * 2);
                snowCtx.fillStyle = `rgba(255,255,255,${s.opacity})`; snowCtx.fill();
                s.x += dx; s.y += dy;
            });
            shootingStars = shootingStars.filter(Boolean);
            if (shootingStars.length < 6) spawnStar();
            snowRAF = requestAnimationFrame(animateGalaxy);
        }

        /* â”€â”€ FORÃŠT : lucioles â”€â”€ */
        let lucioles = [], foretActive = false;
        function initForet() {
            snowCanvas.width = window.innerWidth; snowCanvas.height = window.innerHeight;
            lucioles = [];
            for (let i = 0; i < 80; i++) lucioles.push({
                x: Math.random() * snowCanvas.width, y: Math.random() * snowCanvas.height,
                r: Math.random() * 2.5 + 1,
                vx: (Math.random() - 0.5) * 0.4, vy: (Math.random() - 0.5) * 0.4,
                phase: Math.random() * Math.PI * 2, phaseSpeed: Math.random() * 0.03 + 0.015,
                hue: Math.random() * 60 + 80 // vert-jaune
            });
        }
        function animateForet() {
            if (!foretActive) return;
            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            // brume verte subtile en bas
            let fog = snowCtx.createLinearGradient(0, snowCanvas.height * 0.7, 0, snowCanvas.height);
            fog.addColorStop(0, 'rgba(0,40,10,0)'); fog.addColorStop(1, 'rgba(0,40,10,0.18)');
            snowCtx.fillStyle = fog; snowCtx.fillRect(0, 0, snowCanvas.width, snowCanvas.height);
            lucioles.forEach(f => {
                f.phase += f.phaseSpeed; f.x += f.vx + Math.sin(f.phase * 0.7) * 0.3; f.y += f.vy + Math.cos(f.phase * 0.5) * 0.2;
                if (f.x < 0) f.x = snowCanvas.width; if (f.x > snowCanvas.width) f.x = 0;
                if (f.y < 0) f.y = snowCanvas.height; if (f.y > snowCanvas.height) f.y = 0;
                let glow = 0.3 + 0.7 * Math.abs(Math.sin(f.phase));
                // Halo externe
                let g = snowCtx.createRadialGradient(f.x, f.y, 0, f.x, f.y, f.r * 6);
                g.addColorStop(0, `hsla(${f.hue},100%,65%,${glow * 0.35})`);
                g.addColorStop(1, 'transparent');
                snowCtx.beginPath(); snowCtx.arc(f.x, f.y, f.r * 6, 0, Math.PI * 2);
                snowCtx.fillStyle = g; snowCtx.fill();
                // Corps lumineux
                snowCtx.beginPath(); snowCtx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                snowCtx.fillStyle = `hsla(${f.hue},100%,80%,${glow})`; snowCtx.fill();
            });
            snowRAF = requestAnimationFrame(animateForet);
        }

        /* â”€â”€ DÃ‰SERT : chaleur + grains de sable â”€â”€ */
        let grains = [], heatWaves = [], desertActive = false, desertT = 0;
        function initDesert() {
            snowCanvas.width = window.innerWidth; snowCanvas.height = snowCanvas.height;
            grains = [];
            for (let i = 0; i < 120; i++) grains.push({
                x: Math.random() * snowCanvas.width, y: Math.random() * snowCanvas.height,
                r: Math.random() * 1.5 + 0.5,
                vx: (Math.random() - 0.5) * 1.2, vy: -Math.random() * 0.8 - 0.2,
                opacity: Math.random() * 0.5 + 0.2, life: Math.random() * 100
            });
            heatWaves = [];
            for (let i = 0; i < 5; i++) heatWaves.push({ y: snowCanvas.height * (0.3 + i * 0.14), phase: Math.random() * Math.PI * 2, amp: Math.random() * 8 + 4, speed: Math.random() * 0.012 + 0.005 });
            desertT = 0;
        }
        function animateDesert() {
            if (!desertActive) return;
            desertT++;
            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            // DÃ©gradÃ© de chaleur au sol
            let heat = snowCtx.createLinearGradient(0, snowCanvas.height * 0.6, 0, snowCanvas.height);
            heat.addColorStop(0, 'rgba(200,80,0,0)'); heat.addColorStop(1, 'rgba(200,80,0,0.07)');
            snowCtx.fillStyle = heat; snowCtx.fillRect(0, 0, snowCanvas.width, snowCanvas.height);
            // Ondes de chaleur (lignes sinusoÃ¯dales semi-transparentes)
            heatWaves.forEach(w => {
                w.phase += w.speed;
                snowCtx.beginPath();
                for (let x = 0; x < snowCanvas.width; x += 2) {
                    let y = w.y + Math.sin(x * 0.015 + w.phase) * w.amp + Math.sin(x * 0.03 + w.phase * 1.3) * w.amp * 0.4;
                    x === 0 ? snowCtx.moveTo(x, y) : snowCtx.lineTo(x, y);
                }
                snowCtx.strokeStyle = 'rgba(255,160,50,0.07)'; snowCtx.lineWidth = 1.5; snowCtx.stroke();
            });
            // Grains de sable portÃ©s par le vent
            grains.forEach(g => {
                g.x += g.vx; g.y += g.vy + Math.sin(desertT * 0.02 + g.x * 0.01) * 0.3;
                g.life--;
                if (g.life <= 0 || g.x < 0 || g.x > snowCanvas.width || g.y < 0) {
                    g.x = Math.random() * snowCanvas.width; g.y = snowCanvas.height;
                    g.vx = (Math.random() - 0.5) * 1.2; g.vy = -Math.random() * 0.8 - 0.2; g.life = Math.random() * 150 + 50;
                }
                snowCtx.beginPath(); snowCtx.arc(g.x, g.y, g.r, 0, Math.PI * 2);
                snowCtx.fillStyle = `rgba(210,160,80,${g.opacity * (g.life / 50).toFixed(2)})`; snowCtx.fill();
            });
            snowRAF = requestAnimationFrame(animateDesert);
        }

        /* â”€â”€ OCÃ‰AN : bulles + vagues â”€â”€ */
        let bulles = [], vagues = [], oceanActive = false, oceanT = 0;
        function initOcean() {
            snowCanvas.width = window.innerWidth; snowCanvas.height = window.innerHeight;
            bulles = [];
            for (let i = 0; i < 60; i++) bulles.push({
                x: Math.random() * snowCanvas.width,
                y: snowCanvas.height + Math.random() * 200,
                r: Math.random() * 4 + 1.5,
                speed: Math.random() * 0.8 + 0.3,
                wobble: Math.random() * Math.PI * 2,
                wobbleSpeed: Math.random() * 0.04 + 0.02,
                opacity: Math.random() * 0.4 + 0.15
            });
            vagues = [];
            for (let i = 0; i < 4; i++) vagues.push({
                y: snowCanvas.height * (0.55 + i * 0.12),
                phase: i * Math.PI / 2,
                speed: 0.008 + i * 0.003,
                amp: 12 - i * 2,
                color: `rgba(30,${120 + i * 15},${200 + i * 10},${0.06 - i * 0.01})`
            });
            oceanT = 0;
        }
        function animateOcean() {
            if (!oceanActive) return;
            oceanT++;
            snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
            // Lueur sous-marine du bas
            let glow = snowCtx.createLinearGradient(0, snowCanvas.height * 0.5, 0, snowCanvas.height);
            glow.addColorStop(0, 'rgba(0,60,120,0)'); glow.addColorStop(1, 'rgba(0,60,120,0.12)');
            snowCtx.fillStyle = glow; snowCtx.fillRect(0, 0, snowCanvas.width, snowCanvas.height);
            // Vagues lumineuses
            vagues.forEach(v => {
                v.phase += v.speed;
                snowCtx.beginPath();
                for (let x = 0; x < snowCanvas.width; x += 3) {
                    let y = v.y + Math.sin(x * 0.012 + v.phase) * v.amp + Math.sin(x * 0.025 + v.phase * 0.7) * v.amp * 0.5;
                    x === 0 ? snowCtx.moveTo(x, y) : snowCtx.lineTo(x, y);
                }
                snowCtx.lineTo(snowCanvas.width, snowCanvas.height); snowCtx.lineTo(0, snowCanvas.height); snowCtx.closePath();
                snowCtx.fillStyle = v.color; snowCtx.fill();
            });
            // Bulles
            bulles.forEach(b => {
                b.wobble += b.wobbleSpeed; b.y -= b.speed; b.x += Math.sin(b.wobble) * 0.5;
                if (b.y < -b.r * 2) { b.y = snowCanvas.height + 20; b.x = Math.random() * snowCanvas.width; }
                // Bulle avec reflet
                snowCtx.beginPath(); snowCtx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                snowCtx.strokeStyle = `rgba(100,200,255,${b.opacity})`; snowCtx.lineWidth = 1; snowCtx.stroke();
                snowCtx.beginPath(); snowCtx.arc(b.x - b.r * 0.3, b.y - b.r * 0.3, b.r * 0.35, 0, Math.PI * 2);
                snowCtx.fillStyle = `rgba(200,240,255,${b.opacity * 0.8})`; snowCtx.fill();
            });
            snowRAF = requestAnimationFrame(animateOcean);
        }

        function startSnow() { if (snowActive) return; stopCanvas(); snowActive = true; initSnow(); animateSnow(); }
        function startGalaxy() { if (galaxyActive) return; stopCanvas(); galaxyActive = true; initGalaxy(); animateGalaxy(); }
        function startForet() { if (foretActive) return; stopCanvas(); foretActive = true; initForet(); animateForet(); }
        function startDesert() { if (desertActive) return; stopCanvas(); desertActive = true; initDesert(); animateDesert(); }
        function startOcean() { if (oceanActive) return; stopCanvas(); oceanActive = true; initOcean(); animateOcean(); }
        function stopCanvas() { snowActive = false; galaxyActive = false; foretActive = false; desertActive = false; oceanActive = false; cancelAnimationFrame(snowRAF); snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height); }
        window.addEventListener('resize', () => { if (snowActive) initSnow(); if (galaxyActive) initGalaxy(); if (foretActive) initForet(); if (desertActive) initDesert(); if (oceanActive) initOcean(); });

        /* â”€â”€ SVG MARIO CHARS â”€â”€ */
        // TÃªtes SVG simplifiÃ©es style pixel art
        const marioSVGs = {
            rouge: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Mario -->
        <rect x="8" y="2" width="16" height="4" fill="#e63946"/>
        <rect x="6" y="6" width="20" height="2" fill="#e63946"/>
        <rect x="4" y="8" width="6" height="2" fill="#8B4513"/><rect x="10" y="8" width="14" height="2" fill="#ffe0bd"/><rect x="24" y="8" width="4" height="2" fill="#8B4513"/>
        <rect x="4" y="10" width="24" height="8" fill="#ffe0bd"/>
        <rect x="6" y="12" width="4" height="4" fill="#222"/><rect x="7" y="13" width="2" height="2" fill="#fff"/><rect x="22" y="12" width="4" height="4" fill="#222"/><rect x="23" y="13" width="2" height="2" fill="#fff"/>
        <rect x="10" y="16" width="12" height="2" fill="#c0392b"/>
        <rect x="12" y="14" width="2" height="2" fill="#8B4513"/><rect x="18" y="14" width="2" height="2" fill="#8B4513"/>
        <rect x="8" y="18" width="16" height="4" fill="#ffe0bd"/>
        <rect x="6" y="22" width="8" height="2" fill="#e63946"/><rect x="18" y="22" width="8" height="2" fill="#e63946"/>
        <rect x="4" y="24" width="10" height="2" fill="#e63946"/><rect x="18" y="24" width="10" height="2" fill="#e63946"/>
    </svg>`,
            bleu: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Luigi -->
        <rect x="8" y="2" width="16" height="4" fill="#2ecc40"/>
        <rect x="6" y="6" width="20" height="2" fill="#2ecc40"/>
        <rect x="4" y="8" width="6" height="2" fill="#8B4513"/><rect x="10" y="8" width="14" height="2" fill="#ffe0bd"/><rect x="24" y="8" width="4" height="2" fill="#8B4513"/>
        <rect x="4" y="10" width="24" height="8" fill="#ffe0bd"/>
        <rect x="6" y="12" width="4" height="4" fill="#222"/><rect x="7" y="13" width="2" height="2" fill="#fff"/><rect x="22" y="12" width="4" height="4" fill="#222"/><rect x="23" y="13" width="2" height="2" fill="#fff"/>
        <rect x="10" y="16" width="12" height="2" fill="#8B4513"/>
        <rect x="12" y="14" width="2" height="2" fill="#8B4513"/><rect x="18" y="14" width="2" height="2" fill="#8B4513"/>
        <rect x="8" y="18" width="16" height="4" fill="#ffe0bd"/>
        <rect x="6" y="22" width="8" height="2" fill="#2ecc40"/><rect x="18" y="22" width="8" height="2" fill="#2ecc40"/>
        <rect x="4" y="24" width="10" height="2" fill="#2ecc40"/><rect x="18" y="24" width="10" height="2" fill="#2ecc40"/>
    </svg>`,
            vert: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Yoshi -->
        <rect x="6" y="4" width="20" height="14" rx="4" fill="#2ecc40"/>
        <rect x="8" y="6" width="16" height="10" fill="#2ecc40"/>
        <rect x="8" y="8" width="4" height="4" fill="#fff"/><rect x="9" y="9" width="2" height="2" fill="#111"/>
        <rect x="20" y="8" width="4" height="4" fill="#fff"/><rect x="21" y="9" width="2" height="2" fill="#111"/>
        <rect x="6" y="16" width="20" height="2" fill="#ff6b6b"/>
        <rect x="10" y="18" width="4" height="2" fill="#ff6b6b"/><rect x="18" y="18" width="4" height="2" fill="#ff6b6b"/>
        <rect x="8" y="12" width="16" height="2" fill="#1a9e30"/>
        <rect x="22" y="4" width="6" height="4" rx="1" fill="#e74c3c"/>
        <rect x="24" y="3" width="2" height="2" fill="#e74c3c"/>
        <rect x="6" y="20" width="20" height="6" rx="2" fill="#ffe0bd"/>
        <rect x="12" y="22" width="8" height="2" fill="#ffb3b3"/>
    </svg>`,
            jaune: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Toad -->
        <ellipse cx="16" cy="9" rx="12" ry="9" fill="#f5f5f5"/>
        <circle cx="9" cy="7" r="3" fill="#e63946"/><circle cx="23" cy="7" r="3" fill="#e63946"/>
        <circle cx="13" cy="5" r="2" fill="#e63946"/><circle cx="19" cy="5" rx="2" ry="2" fill="#e63946"/>
        <circle cx="16" cy="4" r="2" fill="#e63946"/>
        <rect x="8" y="14" width="16" height="8" rx="2" fill="#ffe0bd"/>
        <rect x="10" y="16" width="4" height="3" fill="#222"/><rect x="11" y="17" width="2" height="2" fill="#fff"/>
        <rect x="18" y="16" width="4" height="3" fill="#222"/><rect x="19" y="17" width="2" height="2" fill="#fff"/>
        <rect x="12" y="20" width="8" height="1" fill="#c0392b"/>
        <rect x="8" y="22" width="16" height="4" rx="1" fill="#3498db"/>
        <rect x="10" y="22" width="12" height="2" fill="#2980b9"/>
    </svg>`,
            orange: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Wario -->
        <rect x="7" y="2" width="18" height="5" fill="#f1c40f"/>
        <rect x="5" y="7" width="22" height="2" fill="#f1c40f"/>
        <rect x="4" y="9" width="24" height="9" fill="#ffe0bd"/>
        <rect x="5" y="10" width="5" height="4" fill="#222"/><rect x="6" y="11" width="3" height="2" fill="#fff"/>
        <rect x="22" y="10" width="5" height="4" fill="#222"/><rect x="23" y="11" width="3" height="2" fill="#fff"/>
        <rect x="12" y="13" width="8" height="3" fill="#e8c39a"/>
        <rect x="10" y="15" width="5" height="3" fill="#c0392b"/><rect x="17" y="15" width="5" height="3" fill="#c0392b"/>
        <rect x="8" y="18" width="16" height="4" fill="#ffe0bd"/>
        <rect x="6" y="22" width="8" height="2" fill="#f1c40f"/><rect x="18" y="22" width="8" height="2" fill="#f1c40f"/>
        <rect x="4" y="24" width="10" height="2" fill="#f1c40f"/><rect x="18" y="24" width="10" height="2" fill="#f1c40f"/>
        <!-- Moustache W -->
        <rect x="10" y="14" width="12" height="2" fill="#5d3a1a"/>
        <rect x="10" y="14" width="2" height="3" fill="#5d3a1a"/>
        <rect x="14" y="14" width="2" height="3" fill="#5d3a1a"/>
        <rect x="16" y="14" width="2" height="3" fill="#5d3a1a"/>
        <rect x="20" y="14" width="2" height="3" fill="#5d3a1a"/>
    </svg>`,
            violet: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <!-- Bowser amÃ©liorÃ© -->
        <!-- Carapace verte sur le crÃ¢ne -->
        <rect x="7" y="1" width="18" height="6" rx="3" fill="#2d7a1e"/>
        <rect x="9" y="0" width="4" height="3" rx="1" fill="#2d7a1e"/>
        <rect x="19" y="0" width="4" height="3" rx="1" fill="#2d7a1e"/>
        <rect x="14" y="0" width="4" height="2" rx="1" fill="#2d7a1e"/>
        <!-- TÃªte jaune-orange massive -->
        <rect x="4" y="6" width="24" height="16" rx="4" fill="#e8a020"/>
        <!-- Sourcils noirs menaÃ§ants -->
        <rect x="5" y="7" width="9" height="3" rx="1" fill="#111" transform="rotate(-8,9,8)"/>
        <rect x="18" y="7" width="9" height="3" rx="1" fill="#111" transform="rotate(8,23,8)"/>
        <!-- Yeux rouges avec pupilles noires -->
        <ellipse cx="10" cy="13" rx="4" ry="4" fill="#e74c3c"/>
        <ellipse cx="22" cy="13" rx="4" ry="4" fill="#e74c3c"/>
        <ellipse cx="10" cy="13" rx="2" ry="2.5" fill="#111"/>
        <ellipse cx="22" cy="13" rx="2" ry="2.5" fill="#111"/>
        <rect x="9" y="11" width="1" height="1" fill="#fff"/>
        <rect x="21" y="11" width="1" height="1" fill="#fff"/>
        <!-- Museau beige large -->
        <rect x="9" y="17" width="14" height="8" rx="4" fill="#d4a060"/>
        <!-- Narines -->
        <ellipse cx="13" cy="19" rx="2" ry="1.5" fill="#b07840"/>
        <ellipse cx="19" cy="19" rx="2" ry="1.5" fill="#b07840"/>
        <!-- Dents blanches qui dÃ©passent -->
        <rect x="10" y="23" width="5" height="4" rx="1" fill="#fff"/>
        <rect x="17" y="23" width="5" height="4" rx="1" fill="#fff"/>
        <rect x="13" y="24" width="3" height="2" fill="#e8a020"/>
    </svg>`
        };

        // Valeurs jetons par couleur
        const casinoVals = { rouge: '10', bleu: '20', vert: '50', jaune: '100', orange: '200', violet: '1000' };

        // SVG bonbons rÃ©alistes â€” chaque couleur = type de bonbon diffÃ©rent
        const bonbonSVGs = {
            // rouge = sucette ronde brillante
            rouge: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient id="bg_r" cx="38%" cy="32%" r="60%">
                <stop offset="0%" stop-color="#ffccd6"/>
                <stop offset="45%" stop-color="#ff4d6d"/>
                <stop offset="100%" stop-color="#8b0000"/>
            </radialGradient>
        </defs>
        <circle cx="16" cy="13" r="11" fill="url(#bg_r)"/>
        <path d="M9,10 Q16,6 23,10" stroke="rgba(255,255,255,0.35)" stroke-width="2" fill="none" stroke-linecap="round"/>
        <path d="M8,14 Q16,10 24,14" stroke="rgba(255,255,255,0.2)" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <ellipse cx="11" cy="10" rx="3" ry="2" fill="rgba(255,255,255,0.5)" transform="rotate(-30,11,10)"/>
        <rect x="15" y="23" width="2.5" height="8" rx="1" fill="#8B4513"/>
        <ellipse cx="16" cy="23" rx="2" ry="1" fill="#6b3410"/>
    </svg>`,
            // bleu = bonbon emballÃ© (papillote)
            bleu: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient id="bg_b" cx="40%" cy="35%" r="55%">
                <stop offset="0%" stop-color="#cce8ff"/>
                <stop offset="50%" stop-color="#3b82f6"/>
                <stop offset="100%" stop-color="#1e3a8a"/>
            </radialGradient>
        </defs>
        <!-- Corps ovale -->
        <ellipse cx="16" cy="16" rx="10" ry="7" fill="url(#bg_b)"/>
        <!-- Papillote gauche -->
        <ellipse cx="5" cy="16" rx="5" ry="3" fill="#60a5fa" transform="rotate(-15,5,16)"/>
        <line x1="6" y1="13" x2="4" y2="19" stroke="#1d4ed8" stroke-width="0.8"/>
        <line x1="8" y1="13" x2="6" y2="19" stroke="#1d4ed8" stroke-width="0.8"/>
        <!-- Papillote droite -->
        <ellipse cx="27" cy="16" rx="5" ry="3" fill="#60a5fa" transform="rotate(15,27,16)"/>
        <line x1="24" y1="13" x2="26" y2="19" stroke="#1d4ed8" stroke-width="0.8"/>
        <line x1="26" y1="13" x2="28" y2="19" stroke="#1d4ed8" stroke-width="0.8"/>
        <!-- Reflet -->
        <ellipse cx="12" cy="13" rx="3" ry="2" fill="rgba(255,255,255,0.5)" transform="rotate(-20,12,13)"/>
        <!-- Rayures -->
        <ellipse cx="16" cy="16" rx="10" ry="7" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1.5" stroke-dasharray="3,4"/>
    </svg>`,
            // vert = bonbon canne de NoÃ«l (candy cane)
            vert: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="cane_g" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#fff"/>
                <stop offset="40%" stop-color="#fff"/>
                <stop offset="40%" stop-color="#22c55e"/>
                <stop offset="60%" stop-color="#22c55e"/>
                <stop offset="60%" stop-color="#fff"/>
                <stop offset="100%" stop-color="#fff"/>
            </linearGradient>
        </defs>
        <!-- Canne courbÃ©e -->
        <path d="M20,28 L20,10 Q20,3 13,3 Q6,3 6,10" stroke="url(#cane_g)" stroke-width="5" fill="none" stroke-linecap="round"/>
        <path d="M20,28 L20,10 Q20,3 13,3 Q6,3 6,10" stroke="rgba(255,255,255,0.5)" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-dasharray="4,4"/>
        <!-- Reflet -->
        <path d="M18,27 L18,11 Q18,5 13,5" stroke="rgba(255,255,255,0.6)" stroke-width="1" fill="none" stroke-linecap="round"/>
    </svg>`,
            // jaune = bonbon ourson gÃ©latine
            jaune: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient id="bg_y" cx="40%" cy="35%" r="60%">
                <stop offset="0%" stop-color="#fff9c4"/>
                <stop offset="50%" stop-color="#fbbf24"/>
                <stop offset="100%" stop-color="#d97706"/>
            </radialGradient>
        </defs>
        <!-- Corps ourson -->
        <ellipse cx="16" cy="18" rx="9" ry="11" fill="url(#bg_y)"/>
        <!-- TÃªte -->
        <circle cx="16" cy="9" r="7" fill="url(#bg_y)"/>
        <!-- Oreilles -->
        <circle cx="10" cy="5" r="3.5" fill="#fbbf24"/>
        <circle cx="22" cy="5" r="3.5" fill="#fbbf24"/>
        <circle cx="10" cy="5" r="1.5" fill="#f59e0b"/>
        <circle cx="22" cy="5" r="1.5" fill="#f59e0b"/>
        <!-- Visage -->
        <ellipse cx="13" cy="8" rx="1.5" ry="1.8" fill="#7c5c00"/>
        <ellipse cx="19" cy="8" rx="1.5" ry="1.8" fill="#7c5c00"/>
        <ellipse cx="16" cy="11" rx="3" ry="2" fill="#e8a020"/>
        <ellipse cx="15" cy="11" rx="1" ry="0.8" fill="#7c5c00"/>
        <ellipse cx="17" cy="11" rx="1" ry="0.8" fill="#7c5c00"/>
        <!-- Reflet -->
        <ellipse cx="12" cy="7" rx="2" ry="1.5" fill="rgba(255,255,255,0.55)" transform="rotate(-20,12,7)"/>
    </svg>`,
            // orange = M&M / dragÃ©e ronde avec lettre
            orange: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient id="bg_o" cx="38%" cy="32%" r="60%">
                <stop offset="0%" stop-color="#fed7aa"/>
                <stop offset="45%" stop-color="#f97316"/>
                <stop offset="100%" stop-color="#9a3412"/>
            </radialGradient>
        </defs>
        <ellipse cx="16" cy="16" rx="13" ry="12" fill="url(#bg_o)"/>
        <!-- Reflet haut -->
        <ellipse cx="11" cy="10" rx="4" ry="3" fill="rgba(255,255,255,0.45)" transform="rotate(-25,11,10)"/>
        <!-- Lettre M -->
        <text x="16" y="20" text-anchor="middle" font-family="Arial Black,sans-serif" font-weight="900" font-size="11" fill="rgba(255,255,255,0.85)">m</text>
        <!-- Ombre lÃ©gÃ¨re bas -->
        <ellipse cx="16" cy="25" rx="11" ry="3" fill="rgba(0,0,0,0.15)"/>
    </svg>`,
            // violet = macaron franÃ§ais
            violet: `<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient id="mac_top" cx="45%" cy="35%" r="55%">
                <stop offset="0%" stop-color="#e9d5ff"/>
                <stop offset="60%" stop-color="#a855f7"/>
                <stop offset="100%" stop-color="#581c87"/>
            </radialGradient>
        </defs>
        <!-- Disque bas -->
        <ellipse cx="16" cy="22" rx="12" ry="5" fill="#7e22ce"/>
        <!-- CrÃ¨me au milieu -->
        <rect x="4" y="17" width="24" height="5" rx="1" fill="#f3e8ff"/>
        <!-- Disque haut -->
        <ellipse cx="16" cy="14" rx="12" ry="8" fill="url(#mac_top)"/>
        <!-- Pied (collerette) -->
        <ellipse cx="16" cy="20" rx="12" ry="3" fill="#9333ea" opacity="0.6"/>
        <!-- Reflet -->
        <ellipse cx="12" cy="11" rx="4" ry="3" fill="rgba(255,255,255,0.45)" transform="rotate(-20,12,11)"/>
        <!-- Points dÃ©co -->
        <circle cx="10" cy="12" r="1" fill="rgba(255,255,255,0.3)"/>
        <circle cx="22" cy="13" r="0.8" fill="rgba(255,255,255,0.3)"/>
        <circle cx="16" cy="10" r="0.8" fill="rgba(255,255,255,0.25)"/>
    </svg>`
        };

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOTEUR AUDIO
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        let audioCtx = null, masterGain = null, menuOscNodes = [], menuPlaying = false;
        let sndMusique = true, sndSfx = true, sndWin = true, masterVol = 0.6;
        let musicScheduler = null, musicBeat = 0, musicStartTime = 0;

        function getCtx() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioCtx.createGain();
                masterGain.gain.value = masterVol;
                masterGain.connect(audioCtx.destination);
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
            return audioCtx;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MUSIQUE ARCADE â€” style Pac-Man / Galaga / OutRun
           MÃ©lodie entraÃ®nante, beat punchy, basse rebondissante
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        // Gamme en La mineur harmonique â€” son arcade classique
        // Toutes les notes utilisÃ©es dans le morceau
        const N = {
            A2: 110, B2: 123, C3: 131, D3: 147, E3: 165, F3: 175, G3: 196, GS3: 208,
            A3: 220, B3: 247, C4: 262, D4: 294, E4: 330, F4: 349, G4: 392, GS4: 415,
            A4: 440, B4: 494, C5: 523, D5: 587, E5: 659, F5: 698, G5: 784, GS5: 830, A5: 880
        };

        // MÃ‰LODIE PRINCIPALE â€” accrocheuse et joyeuse style Pac-Man/Galaga
        // Format: [note, beat (0-31), durÃ©e en beats]
        const MEL = [
            // Phrase A (mesures 1-2) : montÃ©e Ã©nergique
            [N.A4, 0, 0.4], [N.C5, 0.5, 0.4], [N.E5, 1, 0.4], [N.A5, 1.5, 0.8],
            [N.G5, 2.5, 0.4], [N.E5, 3, 0.4], [N.C5, 3.5, 0.4],
            // Phrase B (mesures 3-4) : descente avec rebond
            [N.D5, 4, 0.4], [N.B4, 4.5, 0.4], [N.GS4, 5, 0.4], [N.E4, 5.5, 0.8],
            [N.F4, 6.5, 0.4], [N.GS4, 7, 0.4], [N.A4, 7.5, 0.4],
            // Phrase C (mesures 5-6) : tension montante
            [N.A4, 8, 0.4], [N.B4, 8.5, 0.4], [N.C5, 9, 0.4], [N.D5, 9.5, 0.4],
            [N.E5, 10, 0.8], [N.D5, 11, 0.4], [N.C5, 11.5, 0.4],
            // Phrase D (mesures 7-8) : rÃ©solution joyeuse
            [N.B4, 12, 0.4], [N.GS4, 12.5, 0.4], [N.A4, 13, 0.8],
            [N.C5, 14, 0.4], [N.E5, 14.5, 0.4], [N.A5, 15, 0.9],
            // Phrase E (mesures 9-10) : variation plus rapide
            [N.A5, 16, 0.3], [N.G5, 16.5, 0.3], [N.E5, 17, 0.3], [N.C5, 17.5, 0.3],
            [N.D5, 18, 0.3], [N.E5, 18.5, 0.3], [N.F5, 19, 0.3], [N.E5, 19.5, 0.3],
            // Phrase F (mesures 11-12)
            [N.D5, 20, 0.3], [N.C5, 20.5, 0.3], [N.B4, 21, 0.3], [N.A4, 21.5, 0.3],
            [N.GS4, 22, 0.3], [N.A4, 22.5, 0.3], [N.B4, 23, 0.3], [N.C5, 23.5, 0.3],
            // Phrase G (mesures 13-14) : montÃ©e finale
            [N.D5, 24, 0.4], [N.E5, 24.5, 0.4], [N.F5, 25, 0.4], [N.GS5, 25.5, 0.4],
            [N.A5, 26, 1.2], [N.G5, 27.5, 0.4],
            // Phrase H (mesure 15-16) : coda percutante
            [N.E5, 28, 0.4], [N.D5, 28.5, 0.4], [N.C5, 29, 0.4], [N.B4, 29.5, 0.4],
            [N.A4, 30, 0.4], [N.C5, 30.5, 0.4], [N.E5, 31, 0.9],
        ];

        // CONTRE-MÃ‰LODIE â€” harmonise Ã  la tierce
        const CMID = [
            [N.E4, 0, 0.4], [N.G4, 0.5, 0.4], [N.C5, 1, 0.4], [N.E5, 1.5, 0.8],
            [N.D5, 2.5, 0.4], [N.C5, 3, 0.4], [N.A4, 3.5, 0.4],
            [N.B3, 4, 0.4], [N.GS3, 4.5, 0.4], [N.E3, 5, 0.4], [N.C4, 5.5, 0.8],
            [N.D4, 6.5, 0.4], [N.E4, 7, 0.4], [N.F4, 7.5, 0.4],
            [N.F4, 8, 1.6], [N.A4, 10, 0.8], [N.G4, 11, 0.4], [N.F4, 11.5, 0.4],
            [N.E4, 12, 0.4], [N.F4, 12.5, 0.4], [N.E4, 13, 0.8],
            [N.G4, 14, 0.4], [N.C5, 14.5, 0.4], [N.E5, 15, 0.9],
        ];

        // BASSE REBONDISSANTE â€” style OutRun / arcade funk
        const BASS = [
            [N.A2, 0, 0.3], [N.A2, 0.5, 0.3], [N.A3, 1, 0.3], [N.A2, 1.5, 0.3],
            [N.A2, 2, 0.3], [N.E3, 2.5, 0.3], [N.A2, 3, 0.3], [N.GS3, 3.5, 0.3],
            [N.A2, 4, 0.3], [N.A2, 4.5, 0.3], [N.D3, 5, 0.3], [N.A2, 5.5, 0.3],
            [N.F3, 6, 0.3], [N.E3, 6.5, 0.3], [N.A2, 7, 0.3], [N.E3, 7.5, 0.3],
            [N.A2, 8, 0.3], [N.C3, 8.5, 0.3], [N.E3, 9, 0.3], [N.A2, 9.5, 0.3],
            [N.A2, 10, 0.3], [N.E3, 10.5, 0.3], [N.A2, 11, 0.3], [N.GS3, 11.5, 0.3],
            [N.A2, 12, 0.3], [N.A2, 12.5, 0.3], [N.E3, 13, 0.3], [N.A2, 13.5, 0.3],
            [N.F3, 14, 0.3], [N.E3, 14.5, 0.3], [N.A2, 15, 0.3], [N.A3, 15.5, 0.3],
            // repeat basse
            [N.A2, 16, 0.3], [N.A2, 16.5, 0.3], [N.A3, 17, 0.3], [N.A2, 17.5, 0.3],
            [N.A2, 18, 0.3], [N.E3, 18.5, 0.3], [N.A2, 19, 0.3], [N.GS3, 19.5, 0.3],
            [N.D3, 20, 0.3], [N.D3, 20.5, 0.3], [N.A3, 21, 0.3], [N.D3, 21.5, 0.3],
            [N.E3, 22, 0.3], [N.E3, 22.5, 0.3], [N.B3, 23, 0.3], [N.E3, 23.5, 0.3],
            [N.A2, 24, 0.3], [N.C3, 24.5, 0.3], [N.E3, 25, 0.3], [N.A3, 25.5, 0.3],
            [N.A2, 26, 0.3], [N.E3, 26.5, 0.3], [N.A3, 27, 0.3], [N.E3, 27.5, 0.3],
            [N.A2, 28, 0.3], [N.A2, 28.5, 0.3], [N.E3, 29, 0.3], [N.A2, 29.5, 0.3],
            [N.A2, 30, 0.3], [N.C3, 30.5, 0.3], [N.E3, 31, 0.3], [N.A3, 31.5, 0.25],
        ];

        // ARPÃˆGE EN FOND â€” shimmer style Galaga
        const ARP = [N.A3, N.E4, N.A4, N.E4, N.A3, N.E4, N.C5, N.E4,
        N.D4, N.A4, N.D5, N.A4, N.E4, N.B4, N.E5, N.B4];

        const BPM = 148;
        const LOOP = 32; // beats par boucle

        function mkOsc(ctx, type, freq, t, dur, gain, filtHz = null, filtQ = 1) {
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(gain, t + 0.012);
            g.gain.setValueAtTime(gain, t + dur - 0.025);
            g.gain.linearRampToValueAtTime(0, t + dur);
            if (filtHz) {
                const f = ctx.createBiquadFilter();
                f.type = 'lowpass'; f.frequency.value = filtHz; f.Q.value = filtQ;
                osc.connect(f); f.connect(g);
            } else { osc.connect(g); }
            g.connect(masterGain);
            osc.start(t); osc.stop(t + dur + 0.05);
            menuOscNodes.push(osc);
        }

        function mkNoise(ctx, gainVal, t, dur, filtType, filtHz, filtQ = 1) {
            const len = Math.max(1, Math.ceil(ctx.sampleRate * dur));
            const buf = ctx.createBuffer(1, len, ctx.sampleRate);
            const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) d[i] = (Math.random() * 2 - 1) * Math.pow(Math.max(0, 1 - i / d.length), 1.3);
            const src = ctx.createBufferSource();
            const filt = ctx.createBiquadFilter(); filt.type = filtType; filt.frequency.value = filtHz; filt.Q.value = filtQ;
            const g = ctx.createGain(); g.gain.setValueAtTime(gainVal, t); g.gain.exponentialRampToValueAtTime(0.001, t + dur);
            src.buffer = buf; src.connect(filt); filt.connect(g); g.connect(masterGain); src.start(t);
            menuOscNodes.push(src);
        }

        function scheduleMusicBeat(b, t, ctx, beat) {
            // â”€â”€ MÃ‰LODIE (onde carrÃ©e brillante â€” son arcade pur) â”€â”€
            MEL.forEach(([freq, start, dur]) => {
                if (Math.abs(b - start) < 0.001) {
                    // Couche principale
                    mkOsc(ctx, 'square', freq, t, dur * beat, 0.14);
                    // Octave basse pour la richesse
                    mkOsc(ctx, 'square', freq / 2, t, dur * beat, 0.05, 1200, 1);
                }
            });

            // â”€â”€ CONTRE-MÃ‰LODIE (triangle doux â€” harmonie) â”€â”€
            CMID.forEach(([freq, start, dur]) => {
                if (Math.abs(b - start) < 0.001) {
                    mkOsc(ctx, 'triangle', freq, t, dur * beat, 0.08);
                }
            });

            // â”€â”€ BASSE (sawtooth filtrÃ© â€” rebondissant) â”€â”€
            BASS.forEach(([freq, start, dur]) => {
                if (Math.abs(b - start) < 0.001 || Math.abs(b - start - 0.5) < 0.001) {
                    const osc = ctx.createOscillator();
                    const filt = ctx.createBiquadFilter();
                    const g = ctx.createGain();
                    osc.type = 'sawtooth'; osc.frequency.value = freq;
                    filt.type = 'lowpass'; filt.Q.value = 5;
                    filt.frequency.setValueAtTime(300, t);
                    filt.frequency.linearRampToValueAtTime(1500, t + 0.018);
                    filt.frequency.exponentialRampToValueAtTime(400, t + dur * beat);
                    g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.38, t + 0.012);
                    g.gain.setValueAtTime(0.38, t + dur * beat - 0.02); g.gain.linearRampToValueAtTime(0, t + dur * beat);
                    osc.connect(filt); filt.connect(g); g.connect(masterGain);
                    osc.start(t); osc.stop(t + dur * beat + 0.04);
                    menuOscNodes.push(osc);
                }
            });

            // â”€â”€ ARPÃˆGE SHIMMER (onde pulse â€” brillant en arriÃ¨re-plan) â”€â”€
            if (b === Math.floor(b)) {
                const arpIdx = Math.floor(b) % ARP.length;
                mkOsc(ctx, 'square', ARP[arpIdx], t, beat * 0.45, 0.04, 2000, 1);
                mkOsc(ctx, 'square', ARP[(arpIdx + 1) % ARP.length], t + beat * 0.5, beat * 0.45, 0.04, 2000, 1);
            }

            // â”€â”€ BATTERIE ARCADE â”€â”€
            // Kick (sine sweep â€” boom classique)
            if (b % 4 === 0 || b % 4 === 2.75) {
                const k = ctx.createOscillator(); const kg = ctx.createGain();
                k.type = 'sine';
                k.frequency.setValueAtTime(160, t); k.frequency.exponentialRampToValueAtTime(30, t + 0.15);
                kg.gain.setValueAtTime(0.8, t); kg.gain.exponentialRampToValueAtTime(0.001, t + 0.18);
                k.connect(kg); kg.connect(masterGain); k.start(t); k.stop(t + 0.2);
                menuOscNodes.push(k);
            }

            // Snare (sur les temps 2 et 4)
            if (b % 4 === 2) {
                mkNoise(ctx, 0.35, t, 0.12, 'bandpass', 2000, 0.8);
                mkOsc(ctx, 'triangle', 200, t, 0.07, 0.2);
            }

            // Hi-hat fermÃ© (chaque demi-beat)
            if (b === Math.floor(b) || (b * 2 === Math.floor(b * 2))) {
                mkNoise(ctx, 0.05, t, 0.025, 'highpass', 9000, 0.5);
            }

            // Hi-hat ouvert (contretemps â€” groove arcade)
            if (Math.abs((b % 2) - 1.5) < 0.001) {
                mkNoise(ctx, 0.07, t, 0.12, 'highpass', 7000, 0.5);
            }

            // Cloche arcade (petite note aiguÃ« sur certains temps â€” feeling bonus/coin)
            if (b % 8 === 4 || b % 8 === 6.5) {
                mkOsc(ctx, 'sine', N.A5 * 2, t, 0.08, 0.06);
            }
        }

        function playChiptune() {
            if (!sndMusique || menuPlaying) return;
            const ctx = getCtx();
            menuPlaying = true;
            musicBeat = 0;
            musicStartTime = ctx.currentTime + 0.08;
            const beat = 60 / BPM;
            const ahead = 0.15;
            const interval = 40;

            function tick() {
                if (!menuPlaying) return;
                const now = ctx.currentTime;
                while (musicBeat * beat < (now - musicStartTime) + ahead) {
                    const b = musicBeat % LOOP;
                    const t = musicStartTime + musicBeat * beat;
                    scheduleMusicBeat(b, t, ctx, beat);
                    musicBeat++;
                }
                musicScheduler = setTimeout(tick, interval);
            }
            tick();
        }

        function stopChiptune() {
            menuPlaying = false;
            clearTimeout(musicScheduler);
            menuOscNodes.forEach(n => { try { n.stop(); } catch (e) { } });
            menuOscNodes = [];
            musicBeat = 0;
        }

        /* â”€â”€ SFX : clic bois â”€â”€ */
        function playWoodClick() {
            if (!sndSfx) return;
            const ctx = getCtx();
            const t = ctx.currentTime;
            const buf = ctx.createBuffer(1, Math.ceil(ctx.sampleRate * 0.12), ctx.sampleRate);
            const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) d[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / d.length, 3);
            const src = ctx.createBufferSource();
            const filt = ctx.createBiquadFilter(); filt.type = 'lowpass'; filt.frequency.value = 800; filt.Q.value = 2;
            const g = ctx.createGain(); g.gain.setValueAtTime(0.5, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.12);
            src.buffer = buf; src.connect(filt); filt.connect(g); g.connect(masterGain); src.start(t);
            const buf2 = ctx.createBuffer(1, Math.ceil(ctx.sampleRate * 0.015), ctx.sampleRate);
            const d2 = buf2.getChannelData(0);
            for (let i = 0; i < d2.length; i++) d2[i] = (Math.random() * 2 - 1);
            const src2 = ctx.createBufferSource();
            const g2 = ctx.createGain(); g2.gain.setValueAtTime(0.3, t); g2.gain.exponentialRampToValueAtTime(0.001, t + 0.015);
            src2.buffer = buf2; src2.connect(g2); g2.connect(masterGain); src2.start(t);
        }

        /* â”€â”€ SFX : victoire â”€â”€ */
        function playVictoire() {
            if (!sndWin) return;
            const ctx = getCtx(); const t = ctx.currentTime + 0.05;
            [N.A4, N.C5, N.E5, N.A5].forEach((f, i) => {
                const o = ctx.createOscillator(), g = ctx.createGain();
                o.type = 'square'; o.frequency.value = f;
                g.gain.setValueAtTime(0, t + i * 0.1); g.gain.linearRampToValueAtTime(0.18, t + i * 0.1 + 0.02);
                g.gain.linearRampToValueAtTime(0, t + i * 0.1 + 0.18);
                o.connect(g); g.connect(masterGain); o.start(t + i * 0.1); o.stop(t + i * 0.1 + 0.2);
            });
        }

        /* â”€â”€ SFX : dÃ©faite â”€â”€ */
        function playDefaite() {
            if (!sndWin) return;
            const ctx = getCtx(); const t = ctx.currentTime + 0.05;
            [N.A4, N.GS4, N.G4, N.F4, N.E4].forEach((f, i) => {
                const o = ctx.createOscillator(), g = ctx.createGain();
                o.type = 'sawtooth'; o.frequency.value = f;
                g.gain.setValueAtTime(0.15, t + i * 0.15); g.gain.exponentialRampToValueAtTime(0.001, t + i * 0.15 + 0.2);
                o.connect(g); g.connect(masterGain); o.start(t + i * 0.15); o.stop(t + i * 0.15 + 0.22);
            });
        }

        /* â”€â”€ ContrÃ´les paramÃ¨tres â”€â”€ */
        function toggleMusique(on) { sndMusique = on; if (on) playChiptune(); else stopChiptune(); }
        function toggleSfx(on) { sndSfx = on; }
        function toggleWin(on) { sndWin = on; }
        function setVolume(v) { masterVol = v / 100; if (masterGain) masterGain.gain.value = masterVol; }

        /* â”€â”€ GAME STATE â”€â”€ */
        let user = { p: '', c: 0, s: ['default'], th: 'default', eq: 'default', themes: ['default'], adm: false };
        let cfg = { nb: 4 }, jeu = { cod: [], ess: [], t: 0, tim: null, deb: 0, win: false };
        const cols = ['rouge', 'bleu', 'vert', 'jaune', 'orange', 'violet'];
        const phrases = ["C'est parti !", "Continue comme Ã§a.", "Pas mal.", "La logique fait le reste.", "MoitiÃ© du chemin.", "Tu te rapproches.", "Le moment de vÃ©ritÃ©.", "Avant-derniÃ¨re chance !", "Dernier essai !"];

        const skins = [
            { id: 'default', nom: 'NÃ©on (Base)', px: 0 },
            { id: 'zebre', nom: 'ZÃ¨bre ğŸ¦“', px: 50 },
            { id: 'planetes', nom: 'PlanÃ¨tes ğŸª', px: 75 },
            { id: 'fruits', nom: 'Fruits ğŸ', px: 75 },
            { id: 'galaxie', nom: 'Galaxie âœ¨', px: 100 },
            { id: 'casino', nom: 'Jetons Casino ğŸ²', px: 120 },
            { id: 'bonbons', nom: 'Bonbons ğŸ¬', px: 100 },
            { id: 'mario', nom: 'Mario Bros ğŸ„', px: 150 },
        ];
        const themes = [
            { id: 'default', nom: 'DÃ©faut (Sombre)', px: 0 },
            { id: 'casino', nom: 'Casino ğŸ°', px: 80 },
            { id: 'noel', nom: 'NoÃ«l ğŸ„', px: 80 },
            { id: 'arcade', nom: 'Arcade RÃ©tro ğŸ‘¾', px: 80 },
            { id: 'galaxy', nom: 'Galaxy ğŸŒŒ', px: 120 },
            { id: 'foret', nom: 'ForÃªt EnchantÃ©e ğŸŒ¿', px: 100 },
            { id: 'desert', nom: 'DÃ©sert & Sable ğŸœï¸', px: 100 },
            { id: 'ocean', nom: 'OcÃ©an ğŸŒŠ', px: 100 },
        ];
        const ALL_S = skins.map(s => s.id), ALL_T = themes.map(t => t.id);

        function applyVisuals() {
            let cls = document.body.className.split(' ').filter(c => !c.startsWith('skin-') && !c.startsWith('theme-')).join(' ').trim();
            document.body.className = cls;
            if (user.eq && user.eq !== 'default') document.body.classList.add('skin-' + user.eq);
            if (user.th && user.th !== 'default') document.body.classList.add('theme-' + user.th);
            if (user.th === 'noel') startSnow();
            else if (user.th === 'galaxy') startGalaxy();
            else if (user.th === 'foret') startForet();
            else if (user.th === 'desert') startDesert();
            else if (user.th === 'ocean') startOcean();
            else stopCanvas();
            // Refresh pions si on est en jeu
            refreshPions();
        }

        function refreshPions() {
            document.querySelectorAll('.emp,.choix').forEach(el => {
                const col = cols.find(c => el.classList.contains(c));
                if (!col) return;
                if (user.eq === 'casino') el.setAttribute('data-val', casinoVals[col] || '');
                else el.removeAttribute('data-val');
                el.innerHTML = '';
                if (user.eq === 'mario' && marioSVGs[col]) el.innerHTML = marioSVGs[col];
                if (user.eq === 'bonbons' && bonbonSVGs[col]) el.innerHTML = bonbonSVGs[col];
            });
        }

        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            $(id).classList.add('active');
            if (id === 'p-menu' || id === 'p-boutique' || id === 'p-score' || id === 'p-params' || id === 'p-mode') {
                $('menu-coins') && ($('menu-coins').innerText = user.c);
                $('shop-coins') && ($('shop-coins').innerText = user.c);
                if (!menuPlaying) playChiptune();
            } else {
                stopChiptune();
            }
            if (id === 'p-boutique') renderShop();
        }

        function switchTab(tab) {
            document.querySelectorAll('.shop-tab').forEach((t, i) => t.classList.toggle('active-tab', (i === 0 && tab === 'skins') || (i === 1 && tab === 'themes')));
            $('tab-skins').classList.toggle('active-section', tab === 'skins');
            $('tab-themes').classList.toggle('active-section', tab === 'themes');
        }

        function save() {
            if (user.adm || user.p.startsWith("Inv_")) return;
            let bdd = JSON.parse(localStorage.getItem('mm_v7') || "{}");
            bdd[user.p] = user; localStorage.setItem('mm_v7', JSON.stringify(bdd));
        }

        function finishAuth(name, admin) {
            if (admin) user = { p: 'Admin', c: "âˆ", s: ALL_S, th: 'default', eq: 'default', themes: ALL_T, adm: true };
            if (!user.th) user.th = 'default';
            if (!user.themes) user.themes = ['default'];
            $('txt-bienvenue').innerText = "Salut, " + user.p;
            $('admin-badge').style.display = user.adm ? "inline-block" : "none";
            applyVisuals(); nav('p-menu');
        }

        function connexion() {
            let p = $('pseudo').value.trim(), m = $('mdp').value;
            if (!p || !m) return alert("Remplissez tout !");
            if (p === 'admin' && m === '1234') return finishAuth(p, true);
            let bdd = JSON.parse(localStorage.getItem('mm_v7') || "{}");
            if (bdd[p]) { if (bdd[p].m !== m) return alert("Mauvais MDP !"); user = bdd[p]; }
            else { user = { p, m, c: 0, s: ['default'], th: 'default', eq: 'default', themes: ['default'], adm: false }; save(); }
            finishAuth(p, false);
        }

        function jouerInvite() {
            user = { p: "Inv_" + Math.floor(Math.random() * 1000), c: 0, s: ['default'], th: 'default', eq: 'default', themes: ['default'], adm: false };
            finishAuth(user.p, false);
        }

        function renderShop() {
            let hS = '';
            skins.forEach(k => {
                let pos = user.adm || user.s.includes(k.id), eq = user.eq === k.id;
                let btn = eq ? `<button class="btn-s" disabled>Ã‰quipÃ©</button>` : (pos ? `<button class="btn-s" onclick="eqpSkin('${k.id}')">Ã‰quiper</button>` : `<button class="btn-p" onclick="achSkin('${k.id}',${k.px})">Acheter</button>`);
                let txt = pos ? "PossÃ©dÃ©" : (user.adm ? "Gratuit" : k.px + " ğŸ’°");
                hS += `<div class="shop-item"><div><h4>${k.nom}</h4><p>${txt}</p></div><div>${btn}</div></div>`;
            });
            $('shop-skins').innerHTML = hS;
            let hT = '';
            themes.forEach(k => {
                let pos = user.adm || (user.themes || ['default']).includes(k.id), eq = (user.th || 'default') === k.id;
                let btn = eq ? `<button class="btn-s" disabled>Ã‰quipÃ©</button>` : (pos ? `<button class="btn-s" onclick="eqpTheme('${k.id}')">Ã‰quiper</button>` : `<button class="btn-p" onclick="achTheme('${k.id}',${k.px})">Acheter</button>`);
                let txt = pos ? "PossÃ©dÃ©" : (user.adm ? "Gratuit" : k.px + " ğŸ’°");
                hT += `<div class="shop-item"><div><h4>${k.nom}</h4><p>${txt}</p></div><div>${btn}</div></div>`;
            });
            $('shop-themes').innerHTML = hT;
        }

        function achSkin(id, px) { if (user.c >= px) { user.c -= px; user.s.push(id); eqpSkin(id); } else alert("Pas assez de piÃ¨ces !"); }
        function eqpSkin(id) { user.eq = id; applyVisuals(); save(); renderShop(); }
        function achTheme(id, px) { if (user.c >= px) { user.c -= px; if (!user.themes) user.themes = ['default']; user.themes.push(id); eqpTheme(id); } else alert("Pas assez de piÃ¨ces !"); }
        function eqpTheme(id) { user.th = id; applyVisuals(); save(); renderShop(); }

        function makePion(col) {
            let el = document.createElement('div');
            el.className = 'emp ' + col;
            if (user.eq === 'casino') el.setAttribute('data-val', casinoVals[col] || '');
            if (user.eq === 'mario' && marioSVGs[col]) el.innerHTML = marioSVGs[col];
            return el.outerHTML;
        }

        function lancer(n) {
            cfg.nb = n;
            jeu = { cod: Array.from({ length: n }, () => cols[Math.floor(Math.random() * 6)]), ess: [], t: 0, tim: null, deb: Date.now(), win: false };
            $('chrono').innerText = "00:00"; $('txt-mode').innerText = "Mode : " + (n == 6 ? 'HARDCORE' : 'NORMAL');
            $('barre-commentaires').innerText = "PrÃªt Ã  jouer ? âš¡"; $('lignes-c').innerHTML = "";
            for (let i = 0; i < 10; i++) {
                let pions = Array(n).fill(0).map(() => `<div class="emp"></div>`).join('');
                $('lignes-c').innerHTML = `<div class="ligne" id="t-${i}"><div class="pions-container">${pions}</div><div class="bloc-ind" style="grid-template-columns:repeat(${n == 6 ? 3 : 2},1fr)">${Array(n).fill('<div class="pt"></div>').join('')}</div></div>` + $('lignes-c').innerHTML;
            }
            $('pal').innerHTML = cols.map(c => {
                let inner = '';
                if (user.eq === 'mario' && marioSVGs[c]) inner = marioSVGs[c];
                if (user.eq === 'bonbons' && bonbonSVGs[c]) inner = bonbonSVGs[c];
                return `<div class="choix ${c}" onclick="add('${c}')"${user.eq === 'casino' ? ' data-val="' + casinoVals[c] + '"' : ''}>${inner}</div>`;
            }).join('');
            clearInterval(jeu.tim); jeu.tim = setInterval(() => { let s = Math.floor((Date.now() - jeu.deb) / 1000); $('chrono').innerText = Math.floor(s / 60).toString().padStart(2, '0') + ":" + (s % 60).toString().padStart(2, '0'); }, 1000);
            nav('p-jeu');
        }

        function add(c) {
            if (jeu.ess.length < cfg.nb) {
                jeu.ess.push(c);
                let el = $('t-' + jeu.t).querySelectorAll('.emp')[jeu.ess.length - 1];
                el.className = 'emp ' + c;
                if (user.eq === 'casino') el.setAttribute('data-val', casinoVals[c] || '');
                if (user.eq === 'mario' && marioSVGs[c]) el.innerHTML = marioSVGs[c];
                if (user.eq === 'bonbons' && bonbonSVGs[c]) el.innerHTML = bonbonSVGs[c];
                playWoodClick();
            }
            $('btn-v').disabled = jeu.ess.length !== cfg.nb;
        }

        function valider() {
            let n = 0, b = 0, cS = [...jeu.cod], cE = [...jeu.ess];
            for (let i = 0; i < cfg.nb; i++) if (cE[i] === cS[i]) { n++; cS[i] = cE[i] = null; }
            for (let i = 0; i < cfg.nb; i++) if (cE[i] && cS.includes(cE[i])) { b++; cS[cS.indexOf(cE[i])] = null; }
            let pts = $('t-' + jeu.t).querySelectorAll('.pt');
            for (let i = 0; i < n; i++) pts[i].className = 'pt noir';
            for (let i = 0; i < b; i++) pts[n + i].className = 'pt blanc';
            if (n === cfg.nb) end(true); else if (jeu.t === 9) end(false); else { $('barre-commentaires').innerText = phrases[jeu.t]; jeu.t++; jeu.ess = []; $('btn-v').disabled = true; }
        }

        function end(v) {
            clearInterval(jeu.tim); jeu.win = v; $('modal-fin').style.display = 'flex';
            if (v) { playVictoire(); } else { playDefaite(); }
            if (v) {
                if (!user.adm) user.c += 10; save();
                $('fin-titre').innerText = "VICTOIRE !"; $('fin-titre').style.color = "#10b981";
                $('fin-desc').innerText = `Bravo ${user.p} !\nCode trouvÃ© en ${jeu.t + 1} essai(s).\nGain: +10 ğŸ’°`; $('fin-secret').style.display = "none";
                if (!user.p.startsWith("Inv_") && !user.adm) { let sc = JSON.parse(localStorage.getItem('mm_scores') || "[]"); sc.push({ pseudo: user.p, mode: cfg.nb, essais: jeu.t + 1, temps: $('chrono').innerText, sec: Math.floor((Date.now() - jeu.deb) / 1000) }); localStorage.setItem('mm_scores', JSON.stringify(sc)); }
            } else {
                $('fin-titre').innerText = "Ã‰CHEC"; $('fin-titre').style.color = "#ef4444";
                $('fin-desc').innerText = "Tu as Ã©puisÃ© tes 10 essais..."; $('fin-secret').style.display = "block";
                const dC = { rouge: "Rouge", bleu: "Bleu", vert: "Vert", jaune: "Jaune", orange: "Orange", violet: "Violet" };
                $('secret-texte').innerText = jeu.cod.map(c => dC[c]).join(' â€¢ ');
            }
        }

        function voirScores() {
            let sc = JSON.parse(localStorage.getItem('mm_scores') || "[]");
            sc.sort((a, b) => b.mode - a.mode || a.essais - b.essais || a.sec - b.sec);
            $('corps-scores').innerHTML = sc.length === 0
                ? '<tr><td colspan="4" style="text-align:center;color:#64748b;padding:20px;">Aucun score pour l\'instant ğŸ®</td></tr>'
                : sc.map(s => `<tr><td>${s.pseudo}</td><td>${s.mode === 6 ? 'HARD' : 'NORM'}</td><td>${s.essais}</td><td>${s.temps}</td></tr>`).join('');
            nav('p-score');
        }
    </script>
</body>

</html>