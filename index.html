<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mastermind Pro - Admin System</title>
    <style>
        :root { --p: #4caf50; --s: #448aff; --danger: #f44336; --bg: #121212; --card: #2a2a2a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; justify-content: center; }
        
        .page { display: none; flex-direction: column; align-items: center; width: 100%; max-width: 550px; padding: 20px; animation: fadeIn 0.3s; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); padding: 25px; border-radius: 20px; width: 100%; box-sizing: border-box; border: 1px solid #333; text-align: center; }
        h1 { color: var(--p); text-transform: uppercase; margin-bottom: 10px; }
        input { padding: 12px; border-radius: 10px; border: 1px solid #444; width: 85%; margin: 10px 0; background: #1a1a1a; color: white; }
        
        button { padding: 12px 20px; cursor: pointer; border-radius: 30px; border: none; font-weight: bold; margin: 5px; transition: 0.2s; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }
        .btn-d { background: var(--danger); color: white; }
        button:hover { transform: scale(1.05); filter: brightness(1.2); }
        
        /* TABLEAUX */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th, td { padding: 12px 8px; border-bottom: 1px solid #444; text-align: left; }
        tr:hover { background: rgba(255,255,255,0.05); }

        /* JEU */
        .ligne { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; padding: 8px; background: #333; border-radius: 10px; }
        .emp { width: 30px; height: 30px; border-radius: 50%; background: #1a1a1a; border: 2px solid #444; }
        .bloc-ind { display: grid; gap: 3px; margin-left: 10px; background: #222; padding: 5px; border-radius: 5px; }
        .pt { width: 10px; height: 10px; border-radius: 50%; background: #444; }
        .palette { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px; }
        .choix { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; }

        .rouge { background: #ff5252; } .bleu { background: #448aff; } .vert { background: #4caf50; }
        .jaune { background: #ffeb3b; } .orange { background: #ff9800; } .violet { background: #9c27b0; }
        .noir { background: #000; } .blanc { background: #fff; }
    </style>
</head>
<body>

    <!-- PAGE: LOGIN -->
    <div id="p-login" class="page active">
        <h1>Mastermind</h1>
        <div class="card">
            <input type="text" id="pseudo" placeholder="Pseudo">
            <input type="password" id="mdp" placeholder="Mot de passe">
            <button class="btn-p" onclick="connexion()">Se connecter</button>
            <p style="font-size: 0.7rem; color: #777;">Admin : admin / admin123</p>
        </div>
    </div>

    <!-- PAGE: MENU -->
    <div id="p-menu" class="page">
        <h1 id="txt-bienvenue">Salut !</h1>
        <div class="card">
            <button class="btn-p" onclick="nav('p-mode')" style="width:80%">JOUER</button><br>
            <button class="btn-s" onclick="voirScores()" style="width:80%">SCORES</button><br>
            <div id="section-admin" style="display:none; border-top: 1px solid #444; margin-top:15px; padding-top:15px;">
                <button class="btn-d" onclick="ouvrirAdmin()" style="width:80%">PANEL ADMIN</button>
            </div>
            <button onclick="location.reload()" style="background:#555; color:white; width:80%">DÉCONNEXION</button>
        </div>
    </div>

    <!-- PAGE: ADMIN -->
    <div id="p-admin" class="page">
        <h1>Gestion Utilisateurs</h1>
        <div class="card">
            <table>
                <thead><tr><th>Pseudo</th><th>Action</th></tr></thead>
                <tbody id="liste-users"></tbody>
            </table>
            <br>
            <button class="btn-s" onclick="nav('p-menu')">Retour</button>
        </div>
    </div>

    <!-- PAGE: DIFFICULTÉ -->
    <div id="p-mode" class="page">
        <h1>Mode de jeu</h1>
        <div class="card">
            <button class="btn-s" onclick="lancer(4)">Normal (4 emplacements)</button><br>
            <button class="btn-p" style="background:var(--danger)" onclick="lancer(6)">HARDCORE (6 emplacements)</button><br>
            <button onclick="nav('p-menu')">Retour</button>
        </div>
    </div>

    <!-- PAGE: JEU -->
    <div id="p-jeu" class="page">
        <div style="display:flex; justify-content: space-between; width:100%; margin-bottom:10px;">
            <span id="chrono" style="color:var(--s); font-weight:bold;">00:00</span>
            <span id="txt-mode">Mode: 4</span>
        </div>
        <div id="plateau" style="background:#2a2a2a; padding:15px; border-radius:15px;">
            <div id="lignes-c"></div>
        </div>
        <div class="palette" id="pal"></div>
        <button id="btn-v" class="btn-p" onclick="valider()" disabled>Valider la ligne</button>
    </div>

    <!-- PAGE: SCORES -->
    <div id="p-score" class="page">
        <h1>Classement</h1>
        <div class="card">
            <table id="table-scores">
                <thead><tr><th>Joueur</th><th>Mode</th><th>Essais</th><th>Temps</th></tr></thead>
                <tbody id="corps-scores"></tbody>
            </table>
            <br>
            <button class="btn-s" onclick="nav('p-menu')">Retour</button>
        </div>
    </div>

    <script>
        let utilisateurActuel = null;
        let config = { nb: 4, tours: 10 };
        let jeu = { code: [], essai: [], tour: 0, timer: null, debut: 0 };
        const couleurs = ['rouge', 'bleu', 'vert', 'jaune', 'orange', 'violet'];

        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- GESTION COMPTES ---
        function connexion() {
            const p = document.getElementById('pseudo').value.trim();
            const m = document.getElementById('mdp').value;
            if(!p || !m) return alert("Champs vides !");

            // Cas Admin
            if(p === "admin" && m === "admin123") {
                utilisateurActuel = "admin";
                document.getElementById('section-admin').style.display = "block";
                document.getElementById('txt-bienvenue').innerText = "Mode Administrateur";
                return nav('p-menu');
            }

            let comptes = JSON.parse(localStorage.getItem('m_comptes') || "{}");
            if(comptes[p]) {
                if(comptes[p] !== m) return alert("Mot de passe incorrect");
            } else {
                comptes[p] = m;
                localStorage.setItem('m_comptes', JSON.stringify(comptes));
            }
            utilisateurActuel = p;
            document.getElementById('section-admin').style.display = "none";
            document.getElementById('txt-bienvenue').innerText = "Salut " + p + " !";
            nav('p-menu');
        }

        function ouvrirAdmin() {
            let comptes = JSON.parse(localStorage.getItem('m_comptes') || "{}");
            const liste = document.getElementById('liste-users');
            liste.innerHTML = Object.keys(comptes).map(u => `
                <tr>
                    <td>${u}</td>
                    <td><button class="btn-d" onclick="supprimerUser('${u}')" style="padding:5px 10px; font-size:0.7rem;">Supprimer</button></td>
                </tr>
            `).join('');
            nav('p-admin');
        }

        function supprimerUser(u) {
            if(confirm("Supprimer l'utilisateur " + u + " et ses scores ?")) {
                // Supprimer compte
                let comptes = JSON.parse(localStorage.getItem('m_comptes') || "{}");
                delete comptes[u];
                localStorage.setItem('m_comptes', JSON.stringify(comptes));
                
                // Supprimer ses scores
                let scores = JSON.parse(localStorage.getItem('m_scores') || "[]");
                scores = scores.filter(s => s.pseudo !== u);
                localStorage.setItem('m_scores', JSON.stringify(scores));
                
                ouvrirAdmin(); // Refresh
            }
        }

        // --- LOGIQUE JEU ---
        function lancer(n) {
            config.nb = n;
            jeu.code = Array.from({length:n}, () => couleurs[Math.floor(Math.random()*6)]);
            jeu.essai = []; jeu.tour = 0; jeu.debut = 0;
            clearInterval(jeu.timer);
            document.getElementById('chrono').innerText = "00:00";
            document.getElementById('txt-mode').innerText = "Mode: " + (n==6?'HARD':'NORM');
            
            const cont = document.getElementById('lignes-c');
            cont.innerHTML = "";
            for(let i=0; i<10; i++) {
                const l = document.createElement('div');
                l.className = 'ligne'; l.id = 't-'+i;
                let pions = ""; for(let j=0; j<n; j++) pions += '<div class="emp"></div>';
                l.innerHTML = pions + `<div class="bloc-ind" style="grid-template-columns:repeat(${n==6?3:2},1fr)">${'<div class="pt"></div>'.repeat(n)}</div>`;
                cont.prepend(l);
            }

            const pal = document.getElementById('pal');
            pal.innerHTML = couleurs.map(c => `<div class="choix ${c}" onclick="ajouter('${c}')"></div>`).join('');
            nav('p-jeu');
        }

        function ajouter(c) {
            if(jeu.debut === 0) {
                jeu.debut = Date.now();
                jeu.timer = setInterval(() => {
                    let s = Math.floor((Date.now() - jeu.debut)/1000);
                    document.getElementById('chrono').innerText = Math.floor(s/60).toString().padStart(2,'0') + ":" + (s%60).toString().padStart(2,'0');
                }, 1000);
            }
            if(jeu.essai.length < config.nb) {
                jeu.essai.push(c);
                document.getElementById('t-'+jeu.tour).querySelectorAll('.emp')[jeu.essai.length-1].className = 'emp ' + c;
            }
            document.getElementById('btn-v').disabled = jeu.essai.length !== config.nb;
        }

        function valider() {
            let n = 0, b = 0;
            let cS = [...jeu.code], cE = [...jeu.essai];
            for(let i=0; i<config.nb; i++) if(cE[i]===cS[i]) { n++; cS[i]=null; cE[i]=null; }
            for(let i=0; i<config.nb; i++) if(cE[i] && cS.includes(cE[i])) { b++; cS[cS.indexOf(cE[i])]=null; }

            const pts = document.getElementById('t-'+jeu.tour).querySelectorAll('.pt');
            for(let i=0; i<n; i++) pts[i].className = 'pt noir';
            for(let i=0; i<b; i++) pts[n+i].className = 'pt blanc';

            if(n === config.nb) {
                clearInterval(jeu.timer);
                if(utilisateurActuel !== "admin") sauverScore();
                alert("VICTOIRE !");
                nav('p-menu');
            } else if(jeu.tour === 9) {
                alert("PERDU ! Le code était : " + jeu.code.join('-'));
                nav('p-menu');
            } else {
                jeu.tour++; jeu.essai = [];
                document.getElementById('btn-v').disabled = true;
            }
        }

        function sauverScore() {
            let sc = JSON.parse(localStorage.getItem('m_scores') || "[]");
            sc.push({
                pseudo: utilisateurActuel,
                mode: config.nb,
                essais: jeu.tour + 1,
                temps: document.getElementById('chrono').innerText,
                sec: Math.floor((Date.now() - jeu.debut)/1000)
            });
            localStorage.setItem('m_scores', JSON.stringify(sc));
        }

        function voirScores() {
            let sc = JSON.parse(localStorage.getItem('m_scores') || "[]");
            sc.sort((a,b) => b.mode - a.mode || a.essais - b.essais || a.sec - b.sec);
            document.getElementById('corps-scores').innerHTML = sc.map(s => `
                <tr><td>${s.pseudo}</td><td>${s.mode===6?'HARD':'NORM'}</td><td>${s.essais}</td><td>${s.temps}</td></tr>
            `).join('');
            nav('p-score');
        }
    </script>
</body>
</html>